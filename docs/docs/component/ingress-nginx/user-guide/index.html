<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.102.3" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>User guide | OPSaid</title>
<meta name="description" content="版本信息
以下配置说明均基于官方版本 1.31 做说明。
Support Versions table



Ingress-NGINX version
k8s supported version
Alpine Version
Nginx Version




v1.3.1
1.24, 1.23, …">
<meta property="og:title" content="User guide" />
<meta property="og:description" content="版本信息 以下配置说明均基于官方版本 1.31 做说明。
Support Versions table Ingress-NGINX version k8s supported version Alpine Version Nginx Version v1.3.1 1.24, 1.23, 1.22, 1.21, 1.20 3.16.2 1.19.10† v1.3.0 1.24, 1.23, 1.22, 1.21, 1.20 3.16.0 1.19.10† v1.1.1 1.23, 1.22, 1.21, 1.20, 1.19 3.14.2 1.19.9† v1.0.0 1.22, 1.21, 1.20, 1.19 3.13.5 1.20.1 安装部署 配置示例 参数解析 可用的Annotations 这里仅记录个人认为有比较有用处的几个注解，全部列表可以参考官方文档说明。
在ingress上annotation的键值对只能是字符串类型，数字或布尔类型需通过引号包含，如：&ldquo;100&rdquo;, &ldquo;false&rdquo;。默认键前缀是&quot;nginx.ingress.kubernetes.io&quot;，由参数&quot;&ndash;annotations-prefix&quot;控制。
名称 说明 默认值 可取值 nginx.ingress.kubernetes.io/app-root 当应用请求&quot;/&ldquo;时做302重定向的目标url - - nginx.ingress.kubernetes.io/affinity 用于保持会话连接 - cookie nginx.ingress.kubernetes.io/affinity-mode 同上 balanced &ldquo;balanced&rdquo; or &ldquo;persistent&rdquo; nginx." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/component/ingress-nginx/user-guide/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-09-11T11:13:40+08:00" />
<meta property="article:modified_time" content="2023-03-06T14:08:00+08:00" /><meta property="og:site_name" content="OPSaid" />

<meta itemprop="name" content="User guide">
<meta itemprop="description" content="版本信息 以下配置说明均基于官方版本 1.31 做说明。
Support Versions table Ingress-NGINX version k8s supported version Alpine Version Nginx Version v1.3.1 1.24, 1.23, 1.22, 1.21, 1.20 3.16.2 1.19.10† v1.3.0 1.24, 1.23, 1.22, 1.21, 1.20 3.16.0 1.19.10† v1.1.1 1.23, 1.22, 1.21, 1.20, 1.19 3.14.2 1.19.9† v1.0.0 1.22, 1.21, 1.20, 1.19 3.13.5 1.20.1 安装部署 配置示例 参数解析 可用的Annotations 这里仅记录个人认为有比较有用处的几个注解，全部列表可以参考官方文档说明。
在ingress上annotation的键值对只能是字符串类型，数字或布尔类型需通过引号包含，如：&ldquo;100&rdquo;, &ldquo;false&rdquo;。默认键前缀是&quot;nginx.ingress.kubernetes.io&quot;，由参数&quot;&ndash;annotations-prefix&quot;控制。
名称 说明 默认值 可取值 nginx.ingress.kubernetes.io/app-root 当应用请求&quot;/&ldquo;时做302重定向的目标url - - nginx.ingress.kubernetes.io/affinity 用于保持会话连接 - cookie nginx.ingress.kubernetes.io/affinity-mode 同上 balanced &ldquo;balanced&rdquo; or &ldquo;persistent&rdquo; nginx."><meta itemprop="datePublished" content="2022-09-11T11:13:40+08:00" />
<meta itemprop="dateModified" content="2023-03-06T14:08:00+08:00" />
<meta itemprop="wordCount" content="3703">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="User guide"/>
<meta name="twitter:description" content="版本信息 以下配置说明均基于官方版本 1.31 做说明。
Support Versions table Ingress-NGINX version k8s supported version Alpine Version Nginx Version v1.3.1 1.24, 1.23, 1.22, 1.21, 1.20 3.16.2 1.19.10† v1.3.0 1.24, 1.23, 1.22, 1.21, 1.20 3.16.0 1.19.10† v1.1.1 1.23, 1.22, 1.21, 1.20, 1.19 3.14.2 1.19.9† v1.0.0 1.22, 1.21, 1.20, 1.19 3.13.5 1.20.1 安装部署 配置示例 参数解析 可用的Annotations 这里仅记录个人认为有比较有用处的几个注解，全部列表可以参考官方文档说明。
在ingress上annotation的键值对只能是字符串类型，数字或布尔类型需通过引号包含，如：&ldquo;100&rdquo;, &ldquo;false&rdquo;。默认键前缀是&quot;nginx.ingress.kubernetes.io&quot;，由参数&quot;&ndash;annotations-prefix&quot;控制。
名称 说明 默认值 可取值 nginx.ingress.kubernetes.io/app-root 当应用请求&quot;/&ldquo;时做302重定向的目标url - - nginx.ingress.kubernetes.io/affinity 用于保持会话连接 - cookie nginx.ingress.kubernetes.io/affinity-mode 同上 balanced &ldquo;balanced&rdquo; or &ldquo;persistent&rdquo; nginx."/>




<link rel="preload" href="/scss/main.min.3a569f361d0fc9e237d549f271b0c5c6ac0bb47fe57679fb670a9178c0cec1fb.css" as="style">
<link href="/scss/main.min.3a569f361d0fc9e237d549f271b0c5c6ac0bb47fe57679fb670a9178c0cec1fb.css" rel="stylesheet" integrity="">

<script
  src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?29e809336f76b78232deae2a6d1857ba";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168659370-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="font-weight-bold">OPSaid</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
        <a  class="nav-link" href="/docs/" ><span>Documentation</span></a>
				
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
        <a  class="nav-link" href="https://github.com/opsaid" target="_blank" ><span>GitHub</span></a>
				
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            

  

<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  

  <nav class="collapse td-sidebar-nav foldable-menu" id="td-section-nav">
    
    
    
    
    

    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
        




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docs">
      <input type="checkbox" id="docs-check" checked/>
      <label for="docs-check" ><a href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root">Documentation</a></label>
      
        
        
      
      <ul class="ul-1">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdeploy-k8s">
      <input type="checkbox" id="docsdeploy-k8s-check"/>
      <label for="docsdeploy-k8s-check" ><a href="/docs/deploy-k8s/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 集群部署</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdeploy-k8squickstart">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdeploy-k8squickstart-a" href="/docs/deploy-k8s/quickstart/">快速开始</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdeploy-k8sbinary">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdeploy-k8sbinary-a" href="/docs/deploy-k8s/binary/">官方镜像</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdeploy-k8sfaqs">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdeploy-k8sfaqs-a" href="/docs/deploy-k8s/faqs/">常见问题</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconcepts">
      <input type="checkbox" id="docsconcepts-check"/>
      <label for="docsconcepts-check" ><a href="/docs/concepts/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 数据结构</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsworkloads">
      <input type="checkbox" id="docsconceptsworkloads-check"/>
      <label for="docsconceptsworkloads-check" ><a href="/docs/concepts/workloads/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">工作负载</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-a" href="/docs/concepts/workloads/pods/">Pod</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-volume">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-volume-a" href="/docs/concepts/workloads/pods-volume/">Pod Volume</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-container">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-container-a" href="/docs/concepts/workloads/pods-container/">Pod Container</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-security">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-security-a" href="/docs/concepts/workloads/pods-security/">Pod Security</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-affinity">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-affinity-a" href="/docs/concepts/workloads/pods-affinity/">Pod Affinity</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsdeployments">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsdeployments-a" href="/docs/concepts/workloads/deployments/">Deployment</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsstatefulsets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsstatefulsets-a" href="/docs/concepts/workloads/statefulsets/">StatefulSet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsdaemonsets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsdaemonsets-a" href="/docs/concepts/workloads/daemonsets/">DaemonSet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsjobs">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsjobs-a" href="/docs/concepts/workloads/jobs/">Job</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadscronjobs">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadscronjobs-a" href="/docs/concepts/workloads/cronjobs/">CronJob</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsreplicationcontrollers">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsreplicationcontrollers-a" href="/docs/concepts/workloads/replicationcontrollers/">ReplicationController</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsnetwork">
      <input type="checkbox" id="docsconceptsnetwork-check"/>
      <label for="docsconceptsnetwork-check" ><a href="/docs/concepts/network/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">网络资源</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkingress">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkingress-a" href="/docs/concepts/network/ingress/">Ingress</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkservice">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkservice-a" href="/docs/concepts/network/service/">Service</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkendpoints">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkendpoints-a" href="/docs/concepts/network/endpoints/">Endpoints</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkendpoint-slice">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkendpoint-slice-a" href="/docs/concepts/network/endpoint-slice/">EndpointSlice</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsconfiguration">
      <input type="checkbox" id="docsconceptsconfiguration-check"/>
      <label for="docsconceptsconfiguration-check" ><a href="/docs/concepts/configuration/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">配置资源</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsconfigurationconfigmaps">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsconfigurationconfigmaps-a" href="/docs/concepts/configuration/configmaps/">ConfigMap</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsconfigurationsecrets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsconfigurationsecrets-a" href="/docs/concepts/configuration/secrets/">Secret</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptskubeadm">
      <input type="checkbox" id="docsconceptskubeadm-check"/>
      <label for="docsconceptskubeadm-check" ><a href="/docs/concepts/kubeadm/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubeadm</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadminit">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadminit-a" href="/docs/concepts/kubeadm/init/">Init</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmcluster">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmcluster-a" href="/docs/concepts/kubeadm/cluster/">Cluster</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmjoin">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmjoin-a" href="/docs/concepts/kubeadm/join/">Join</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmkubelet">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmkubelet-a" href="/docs/concepts/kubeadm/kubelet/">Kubelet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmkube-proxy">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmkube-proxy-a" href="/docs/concepts/kubeadm/kube-proxy/">Kube Proxy</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docscomponent">
      <input type="checkbox" id="docscomponent-check" checked/>
      <label for="docscomponent-check" ><a href="/docs/component/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 基础组件</a></label>
      
        
        
      
      <ul class="ul-2">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-apiserver">
      <input type="checkbox" id="docscomponentkube-apiserver-check"/>
      <label for="docscomponentkube-apiserver-check" ><a href="/docs/component/kube-apiserver/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-apiserver</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-apiserverconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-apiserverconfig-a" href="/docs/component/kube-apiserver/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-controller-manager">
      <input type="checkbox" id="docscomponentkube-controller-manager-check"/>
      <label for="docscomponentkube-controller-manager-check" ><a href="/docs/component/kube-controller-manager/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-controller-manager</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-controller-managerconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-controller-managerconfig-a" href="/docs/component/kube-controller-manager/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-scheduler">
      <input type="checkbox" id="docscomponentkube-scheduler-check"/>
      <label for="docscomponentkube-scheduler-check" ><a href="/docs/component/kube-scheduler/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-scheduler</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-schedulerconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-schedulerconfig-a" href="/docs/component/kube-scheduler/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkubelet">
      <input type="checkbox" id="docscomponentkubelet-check"/>
      <label for="docscomponentkubelet-check" ><a href="/docs/component/kubelet/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kubelet</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkubeletconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkubeletconfig-a" href="/docs/component/kubelet/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-proxy">
      <input type="checkbox" id="docscomponentkube-proxy-check"/>
      <label for="docscomponentkube-proxy-check" ><a href="/docs/component/kube-proxy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-proxy</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-proxyconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-proxyconfig-a" href="/docs/component/kube-proxy/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentcontainers">
      <input type="checkbox" id="docscomponentcontainers-check"/>
      <label for="docscomponentcontainers-check" ><a href="/docs/component/containers/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">containers</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcontainerscontainerd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcontainerscontainerd-a" href="/docs/component/containers/containerd/">Containerd</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentoauth2-proxy">
      <input type="checkbox" id="docscomponentoauth2-proxy-check"/>
      <label for="docscomponentoauth2-proxy-check" ><a href="/docs/component/oauth2-proxy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">oauth2 proxy</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentoauth2-proxyconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentoauth2-proxyconfig-a" href="/docs/component/oauth2-proxy/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentcortex">
      <input type="checkbox" id="docscomponentcortex-check"/>
      <label for="docscomponentcortex-check" ><a href="/docs/component/cortex/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">cortex</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexconfig-a" href="/docs/component/cortex/config/">配置结构</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexserver">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexserver-a" href="/docs/component/cortex/server/">服务监听</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexstorage">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexstorage-a" href="/docs/component/cortex/storage/">数据存储</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexdistributor">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexdistributor-a" href="/docs/component/cortex/distributor/">Distributor</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexquerier">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexquerier-a" href="/docs/component/cortex/querier/">Querier</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexingester">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexingester-a" href="/docs/component/cortex/ingester/">Ingester</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexcompactor">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexcompactor-a" href="/docs/component/cortex/compactor/">Compactor</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexstore-gateway">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexstore-gateway-a" href="/docs/component/cortex/store-gateway/">Store Gateway</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexfrontend">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexfrontend-a" href="/docs/component/cortex/frontend/">Frontend</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexruler">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexruler-a" href="/docs/component/cortex/ruler/">Ruler</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexalertmanager">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexalertmanager-a" href="/docs/component/cortex/alertmanager/">Alertmanager</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcortexlimits">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcortexlimits-a" href="/docs/component/cortex/limits/">资源限制</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentthanos">
      <input type="checkbox" id="docscomponentthanos-check"/>
      <label for="docscomponentthanos-check" ><a href="/docs/component/thanos/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Thanos</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosquery-frontend">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosquery-frontend-a" href="/docs/component/thanos/query-frontend/">Query Frontend</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosquery">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosquery-a" href="/docs/component/thanos/query/">Query</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosreceiver">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosreceiver-a" href="/docs/component/thanos/receiver/">Receiver</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosconfig-a" href="/docs/component/thanos/config/">Config</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosrule">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosrule-a" href="/docs/component/thanos/rule/">Rule</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docscomponentingress-nginx">
      <input type="checkbox" id="docscomponentingress-nginx-check" checked/>
      <label for="docscomponentingress-nginx-check" ><a href="/docs/component/ingress-nginx/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Ingress Nginx</a></label>
      
        
        
      
      <ul class="ul-3">

        
          
            
              
              
              
              
                <li class="without-sib active-path" id="m-docscomponentingress-nginxuser-guide">
                  <span  id="td-sidebar-nav-active-item" >
                    
                      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docscomponentingress-nginxuser-guide-a" href="/docs/component/ingress-nginx/user-guide/">User guide</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib" id="m-docscomponentingress-nginxnginx-template">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentingress-nginxnginx-template-a" href="/docs/component/ingress-nginx/nginx-template/">Nginx Template</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docssecurity">
      <input type="checkbox" id="docssecurity-check"/>
      <label for="docssecurity-check" ><a href="/docs/security/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 原生安全</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docssecuritycis-benchmark">
      <input type="checkbox" id="docssecuritycis-benchmark-check"/>
      <label for="docssecuritycis-benchmark-check" ><a href="/docs/security/cis-benchmark/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">CIS 基准</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarkcontrol-plane">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarkcontrol-plane-a" href="/docs/security/cis-benchmark/control-plane/">控制平面</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarketcd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarketcd-a" href="/docs/security/cis-benchmark/etcd/">Etcd集群</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarkauth-audit">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarkauth-audit-a" href="/docs/security/cis-benchmark/auth-audit/">认证审计</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarkworker-nodes">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarkworker-nodes-a" href="/docs/security/cis-benchmark/worker-nodes/">工作节点</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarkpolicies">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarkpolicies-a" href="/docs/security/cis-benchmark/policies/">安全策略</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docssecuritycis-benchmarkkube-bench">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docssecuritycis-benchmarkkube-bench-a" href="/docs/security/cis-benchmark/kube-bench/">检测工具</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevops">
      <input type="checkbox" id="docsdevops-check"/>
      <label for="docsdevops-check" ><a href="/docs/devops/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">流程与自动化</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopsgitlab">
      <input type="checkbox" id="docsdevopsgitlab-check"/>
      <label for="docsdevopsgitlab-check" ><a href="/docs/devops/gitlab/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Gitlab</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopsgitlabgiltab-ci">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopsgitlabgiltab-ci-a" href="/docs/devops/gitlab/giltab-ci/">Runner</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopskubeadm">
      <input type="checkbox" id="docsdevopskubeadm-check"/>
      <label for="docsdevopskubeadm-check" ><a href="/docs/devops/kubeadm/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubeadm</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopskubeadmetcd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopskubeadmetcd-a" href="/docs/devops/kubeadm/etcd/">Etcd</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopspackages">
      <input type="checkbox" id="docsdevopspackages-check"/>
      <label for="docsdevopspackages-check" ><a href="/docs/devops/packages/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用打包</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackageskaniko">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackageskaniko-a" href="/docs/devops/packages/kaniko/">Kaniko</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackagesmulti-arch">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackagesmulti-arch-a" href="/docs/devops/packages/multi-arch/">Multi Arch</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackagesfpm">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackagesfpm-a" href="/docs/devops/packages/fpm/">Fpm</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdev-framework">
      <input type="checkbox" id="docsdev-framework-check"/>
      <label for="docsdev-framework-check" ><a href="/docs/dev-framework/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用开发框架</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdev-frameworkgo">
      <input type="checkbox" id="docsdev-frameworkgo-check"/>
      <label for="docsdev-frameworkgo-check" ><a href="/docs/dev-framework/go/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Go 语言</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdev-frameworkgogrpc-kit">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdev-frameworkgogrpc-kit-a" href="/docs/dev-framework/go/grpc-kit/">gRPC Kit</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdata-store">
      <input type="checkbox" id="docsdata-store-check"/>
      <label for="docsdata-store-check" ><a href="/docs/data-store/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">存储与数据库</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdata-storeobject-storage">
      <input type="checkbox" id="docsdata-storeobject-storage-check"/>
      <label for="docsdata-storeobject-storage-check" ><a href="/docs/data-store/object-storage/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">对象存储</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagekey-terms">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagekey-terms-a" href="/docs/data-store/object-storage/key-terms/">关键术语</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storageproviders">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storageproviders-a" href="/docs/data-store/object-storage/providers/">云提供商</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagecreate-bucket">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagecreate-bucket-a" href="/docs/data-store/object-storage/create-bucket/">接口：CreateBucket</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storageget-bucket-location">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storageget-bucket-location-a" href="/docs/data-store/object-storage/get-bucket-location/">接口：GetBucketLocation</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagehead-bucket">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagehead-bucket-a" href="/docs/data-store/object-storage/head-bucket/">接口：HeadBucket</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagedelete-bucket">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagedelete-bucket-a" href="/docs/data-store/object-storage/delete-bucket/">接口：DeleteBucket</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagelist-buckets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagelist-buckets-a" href="/docs/data-store/object-storage/list-buckets/">接口：ListBuckets</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagecopy-object">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagecopy-object-a" href="/docs/data-store/object-storage/copy-object/">接口：CopyObject</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagedelete-object">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagedelete-object-a" href="/docs/data-store/object-storage/delete-object/">接口：DeleteObject</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagedelete-objects">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagedelete-objects-a" href="/docs/data-store/object-storage/delete-objects/">接口：DeleteObjects</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storageget-object">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storageget-object-a" href="/docs/data-store/object-storage/get-object/">接口：GetObject</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagehead-object">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagehead-object-a" href="/docs/data-store/object-storage/head-object/">接口：HeadObject</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagelist-objects">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagelist-objects-a" href="/docs/data-store/object-storage/list-objects/">接口：ListObjects</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagelist-objects-v2">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagelist-objects-v2-a" href="/docs/data-store/object-storage/list-objects-v2/">接口：ListObjectsV2</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storageput-object">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storageput-object-a" href="/docs/data-store/object-storage/put-object/">接口：PUTObject</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdata-storeobject-storagerclone">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdata-storeobject-storagerclone-a" href="/docs/data-store/object-storage/rclone/">工具：Rclone</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitor">
      <input type="checkbox" id="docscloud-monitor-check"/>
      <label for="docscloud-monitor-check" ><a href="/docs/cloud-monitor/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">监控告警配置</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitorpreset-metrics">
      <input type="checkbox" id="docscloud-monitorpreset-metrics-check"/>
      <label for="docscloud-monitorpreset-metrics-check" ><a href="/docs/cloud-monitor/preset-metrics/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">预设指标</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsnode-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsnode-exporter-a" href="/docs/cloud-monitor/preset-metrics/node-exporter/">Node Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsingress-nginx">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsingress-nginx-a" href="/docs/cloud-monitor/preset-metrics/ingress-nginx/">Ingress Nginx</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsburrow-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsburrow-exporter-a" href="/docs/cloud-monitor/preset-metrics/burrow-exporter/">Kafka consumer lag</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskafka-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskafka-exporter-a" href="/docs/cloud-monitor/preset-metrics/kafka-exporter/">Kafka Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricszookeeper-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricszookeeper-exporter-a" href="/docs/cloud-monitor/preset-metrics/zookeeper-exporter/">ZooKeeper Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsetcd-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsetcd-exporter-a" href="/docs/cloud-monitor/preset-metrics/etcd-exporter/">Etcd Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskube-metrics-server">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskube-metrics-server-a" href="/docs/cloud-monitor/preset-metrics/kube-metrics-server/">Kube Metrics Server</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskube-state-metrics">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskube-state-metrics-a" href="/docs/cloud-monitor/preset-metrics/kube-state-metrics/">Kube State Metrics</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitoralert-rules">
      <input type="checkbox" id="docscloud-monitoralert-rules-check"/>
      <label for="docscloud-monitoralert-rules-check" ><a href="/docs/cloud-monitor/alert-rules/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">告警规则</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-rulesnode-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-rulesnode-exporter-a" href="/docs/cloud-monitor/alert-rules/node-exporter/">Node Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-rulesetcd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-rulesetcd-a" href="/docs/cloud-monitor/alert-rules/etcd/">Etcd Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-ruleskube-state-metrics">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-ruleskube-state-metrics-a" href="/docs/cloud-monitor/alert-rules/kube-state-metrics/">Kube State Metrics</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscase-studies">
      <input type="checkbox" id="docscase-studies-check"/>
      <label for="docscase-studies-check" ><a href="/docs/case-studies/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用案例研究</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscase-studiesapp-deploy">
      <input type="checkbox" id="docscase-studiesapp-deploy-check"/>
      <label for="docscase-studiesapp-deploy-check" ><a href="/docs/case-studies/app-deploy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">服务部署</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscase-studiesapp-deployphp-on-k8s">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscase-studiesapp-deployphp-on-k8s-a" href="/docs/case-studies/app-deploy/php-on-k8s/">PHP 在 K8S 上</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

    </ul>
  </nav>
</div>



<script>
  var activeElement = document.getElementById('td-sidebar-nav-active-item');
  var topPos = activeElement.offsetTop;
  var scrollElement = document.getElementById('td-section-nav');
  var topCor = scrollElement.offsetTop;
  var heightCor = scrollElement.clientHeight;
  var scrollValue = topPos-topCor-heightCor/2;
  scrollElement.scrollTop = scrollValue;
</script>



          </aside>


          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">




</div>

            


<h5>目录</h5>
<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#版本信息">版本信息</a>
      <ul>
        <li><a href="#support-versions-table">Support Versions table</a></li>
      </ul>
    </li>
    <li><a href="#安装部署">安装部署</a></li>
    <li><a href="#配置示例">配置示例</a></li>
    <li><a href="#参数解析">参数解析</a>
      <ul>
        <li><a href="#可用的annotations">可用的Annotations</a></li>
        <li><a href="#命令行参数">命令行参数</a></li>
        <li><a href="#configmap-配置参数">ConfigMap 配置参数</a></li>
      </ul>
    </li>
    <li><a href="#各个配置例子">各个配置例子</a>
      <ul>
        <li><a href="#自定义nginx模版">自定义Nginx模版</a></li>
        <li><a href="#代理tcp与udp流量">代理TCP与UDP流量</a></li>
        <li><a href="#app-root">app-root</a></li>
        <li><a href="#affinity">affinity</a></li>
        <li><a href="#auth">auth</a></li>
        <li><a href="#canary">canary</a></li>
        <li><a href="#日志格式">日志格式</a></li>
        <li><a href="#客户端通过snippet自定义nginxconf配置">客户端通过snippet自定义nginx.conf配置</a></li>
        <li><a href="#服务端通过snippet自定义nginxconf配置">服务端通过snippet自定义nginx.conf配置</a></li>
        <li><a href="#监听的几个端口">监听的几个端口</a></li>
        <li><a href="#配置404服务后端">配置404服务后端</a></li>
        <li><a href="#pod内核优化">POD内核优化</a></li>
        <li><a href="#url重定向">URL重定向</a></li>
        <li><a href="#防止-xff-伪造">防止 xff 伪造</a></li>
      </ul>
    </li>
  </ul>
</nav></div>




            

	
		
			
		
		



  
  

	
		
			
		
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/docs/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/component/">K8S 基础组件</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/component/ingress-nginx/">Ingress Nginx</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="/docs/component/ingress-nginx/user-guide/">User guide</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>User guide</h1>
	
	<header class="article-meta">
		
		
			
				


			
				


			
		
		
			<p class="reading-time"><i class="fa fa-clock" aria-hidden="true"></i>&nbsp; 18 分钟阅读 &nbsp;</p>

		
	</header>    
	<h2 id="版本信息">版本信息</h2>
<p>以下配置说明均基于官方版本 1.31 做说明。</p>
<h3 id="support-versions-table">Support Versions table</h3>
<table>
<thead>
<tr>
<th>Ingress-NGINX version</th>
<th>k8s supported version</th>
<th>Alpine Version</th>
<th>Nginx Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>v1.3.1</td>
<td>1.24, 1.23, 1.22, 1.21, 1.20</td>
<td>3.16.2</td>
<td>1.19.10†</td>
</tr>
<tr>
<td>v1.3.0</td>
<td>1.24, 1.23, 1.22, 1.21, 1.20</td>
<td>3.16.0</td>
<td>1.19.10†</td>
</tr>
<tr>
<td>v1.1.1</td>
<td>1.23, 1.22, 1.21, 1.20, 1.19</td>
<td>3.14.2</td>
<td>1.19.9†</td>
</tr>
<tr>
<td>v1.0.0</td>
<td>1.22, 1.21, 1.20, 1.19</td>
<td>3.13.5</td>
<td>1.20.1</td>
</tr>
</tbody>
</table>
<h2 id="安装部署">安装部署</h2>
<h2 id="配置示例">配置示例</h2>
<h2 id="参数解析">参数解析</h2>
<h3 id="可用的annotations">可用的Annotations</h3>
<p>这里仅记录个人认为有比较有用处的几个注解，全部列表可以参考<a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/">官方文档</a>说明。</p>
<blockquote>
<blockquote>
<blockquote>
<p>在ingress上annotation的键值对只能是字符串类型，数字或布尔类型需通过引号包含，如：&ldquo;100&rdquo;, &ldquo;false&rdquo;。默认键前缀是&quot;nginx.ingress.kubernetes.io&quot;，由参数&quot;&ndash;annotations-prefix&quot;控制。</p>
</blockquote>
</blockquote>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>默认值</th>
<th>可取值</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#app-root">nginx.ingress.kubernetes.io/app-root</a></td>
<td>当应用请求&quot;/&ldquo;时做302重定向的目标url</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/affinity</a></td>
<td>用于保持会话连接</td>
<td>-</td>
<td>cookie</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/affinity-mode</a></td>
<td>同上</td>
<td>balanced</td>
<td>&ldquo;balanced&rdquo; or &ldquo;persistent&rdquo;</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/affinity-canary-behavior</a></td>
<td>同上</td>
<td>sticky</td>
<td>&ldquo;sticky&rdquo; or &ldquo;legacy&rdquo;</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/session-cookie-name</a></td>
<td>同上</td>
<td>INGRESSCOOKIE</td>
<td>-</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/session-cookie-path</a></td>
<td>同上</td>
<td>/</td>
<td>-</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/session-cookie-secure</a></td>
<td>同上；只能用https协议发送给服务器</td>
<td>false</td>
<td>true, false</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/session-cookie-samesite</a></td>
<td>同上；Chrome 51 开始，浏览器的 Cookie 新增加了一个SameSite属性，用来防止 CSRF 攻击 和用户追踪</td>
<td>-</td>
<td>&ldquo;None&rdquo;, &ldquo;Lax&rdquo;, &ldquo;Strict&rdquo;</td>
</tr>
<tr>
<td><a href="#affinity">nginx.ingress.kubernetes.io/session-cookie-conditional-samesite-none</a></td>
<td>同上</td>
<td>-</td>
<td>&ldquo;true&rdquo;, &ldquo;false&rdquo;</td>
</tr>
<tr>
<td><a href="#auth">nginx.ingress.kubernetes.io/auth-type</a></td>
<td>认证</td>
<td>-</td>
<td>&ldquo;basic&rdquo; or &ldquo;digest&rdquo;</td>
</tr>
<tr>
<td><a href="#auth">nginx.ingress.kubernetes.io/auth-secret</a></td>
<td>同上；存放认证&quot;secret&quot;资源的名称</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#auth">nginx.ingress.kubernetes.io/auth-secret-type</a></td>
<td>同上；存放认证&quot;secret&quot;资源的格式</td>
<td>-</td>
<td>&ldquo;auth-file&rdquo;, &ldquo;auth-map&rdquo;</td>
</tr>
<tr>
<td><a href="#auth">nginx.ingress.kubernetes.io/auth-realm</a></td>
<td>认证</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary</a></td>
<td>灰度、金丝雀发布</td>
<td>-</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-by-header</a></td>
<td>同上，基于HTTP请求头的流量调度，这里对于请求头名称，对应值可取&quot;always&quot;或&quot;never&rdquo;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-by-header-value</a></td>
<td>同上，自定义匹配请求头的值，以代替&quot;always&quot;与&quot;never&quot;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-by-header-pattern</a></td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-by-cookie</a></td>
<td>同上，基于Cookie的流量调度，这里对应cookie名称，对应值可取&quot;always&quot;或&quot;never&quot;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-weight</a></td>
<td>同上，流量调度到灰度副本的权重，填写数字如：30</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><a href="#canary">nginx.ingress.kubernetes.io/canary-weight-total</a></td>
<td>同上，总权重是多少，配合上面使用</td>
<td>-</td>
<td>100</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/client-body-buffer-size]</td>
<td>TODO; HTTP请求体缓冲区大小，如果请求超过这个值会写入nginx配置的temp_path做个缓冲</td>
<td>-</td>
<td>8k</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/configuration-snippet]</td>
<td>TODO; 可自定义nginx配置，比较危险，建议关闭</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/server-snippet]</td>
<td>TODO; 可自定义nginx配置，比较危险，建议关闭</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/stream-snippet]</td>
<td>TODO; 可自定义nginx配置，比较危险，建议关闭</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/custom-http-errors]</td>
<td>TODO; 设置 proxy-intercept-errors</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/default-backend]</td>
<td>TODO；访问该ingress如果后端没有活跃地址，则转发至同空间下配置的服务名, 优先级高于全局配置</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-cors]</td>
<td>TODO; 开启跨域</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/force-ssl-redirect]</td>
<td>TODO; 如果该ingress开启ssl，是否强制跳转http，通过http状态码308</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/ssl-redirect]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/from-to-www-redirect]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/permanent-redirect]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/permanent-redirect-code]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/temporal-redirect]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/preserve-trailing-slash]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-rewrite-log] TODO; 是否开启rewrite日志，默认为关闭</td>
<td>-</td>
<td>-</td>
<td></td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/rewrite-target]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/http2-push-preload]</td>
<td>TODO; HTTP2推送预加载</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/limit-connections]</td>
<td>TODO; 请求限制</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/proxy-body-size]</td>
<td>TODO; 代理配置</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/upstream-hash-by]</td>
<td>TODO; 代理后段算法</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/load-balance]</td>
<td>TODO; 代理后段算法</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/satisfy]</td>
<td>TODO; 不清楚用途</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/server-alias]</td>
<td>TODO; 设置别名，不能冲突</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/ssl-passthrough]</td>
<td>TODO;</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/x-forwarded-prefix]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/upstream-vhost]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-access-log]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-opentracing]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/opentracing-trust-incoming-span]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-influxdb]</td>
<td>写入性能数据至influxdb，在k8s上使用prometheus，这个不建议开启</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/influxdb-measurement]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/influxdb-port]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/influxdb-host]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/influxdb-server-name]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/use-regex]</td>
<td>TODO;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-modsecurity]</td>
<td>开启modsecurity，仅在专用集群使用，业务集群不开启 ｜ - ｜ - ｜</td>
<td></td>
<td></td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/enable-owasp-core-rules]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/modsecurity-transaction-id]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/modsecurity-snippet]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/mirror-request-body]</td>
<td>TODO；镜像</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/mirror-target]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>[nginx.ingress.kubernetes.io/mirror-host]</td>
<td>同上</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="命令行参数">命令行参数</h3>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>默认值</th>
<th>原始HELP</th>
</tr>
</thead>
<tbody>
<tr>
<td>add_dir_header</td>
<td>TODO</td>
<td>TODO</td>
<td>If true, adds the file directory to the header of the log messages</td>
</tr>
<tr>
<td>alsologtostderr</td>
<td>错误输出终端，同时写入也文件</td>
<td>-</td>
<td>log to standard error as well as files (no effect when -logtostderr=true)</td>
</tr>
<tr>
<td>annotations-prefix</td>
<td>ingress使用注解的标签前缀</td>
<td>nginx.ingress.kubernetes.io</td>
<td>Prefix of the Ingress annotations specific to the NGINX controller. (default &ldquo;nginx.ingress.kubernetes.io&rdquo;)</td>
</tr>
<tr>
<td>apiserver-host</td>
<td>连接的api server地址</td>
<td>kubernetes.default.svc</td>
<td>Takes the form &ldquo;protocol://address:port&rdquo;. If not specified, it is assumed the program runs inside a Kubernetes cluster and local discovery is attempted.</td>
</tr>
<tr>
<td>certificate-authority</td>
<td>ca证书，验证api server的https</td>
<td>-</td>
<td>Path to a cert file for the certificate authority. This certificate is used only when the flag &ndash;apiserver-host is specified.</td>
</tr>
<tr>
<td>configmap</td>
<td>用于控制器全局的ConfigMap配置名</td>
<td>nginx-configuration</td>
<td>Name of the ConfigMap containing custom global configurations for the controller.</td>
</tr>
<tr>
<td>controller-class</td>
<td>TODO</td>
<td>k8s.io/ingress-nginx</td>
<td>Ingress Class Controller value this Ingress satisfies. The class of an Ingress object is set using the field IngressClassName in Kubernetes clusters version v1.19.0 or higher. The .spec.controller value of the IngressClass referenced in an Ingress Object should be the same value specified here to make this object be watched.</td>
</tr>
<tr>
<td>deep-inspect</td>
<td>TODO</td>
<td>true</td>
<td>Enables ingress object security deep inspector (default true)</td>
</tr>
<tr>
<td>default-backend-service</td>
<td>处理查询到的主机，流量转发的后段服务</td>
<td>$(POD_NAMESPACE)/ingress-nginx-defaultbackend</td>
<td>Service used to serve HTTP requests not matching any known server name (catch-all). Takes the form &ldquo;namespace/name&rdquo;. The controller configures NGINX to forward requests to the first port of this Service.</td>
</tr>
<tr>
<td>default-server-port</td>
<td>TODO</td>
<td>8181</td>
<td>Port to use for exposing the default server (catch-all).</td>
</tr>
<tr>
<td>default-ssl-certificate</td>
<td>TODO</td>
<td>-</td>
<td>Secret containing a SSL certificate to be used by the default HTTPS server</td>
</tr>
<tr>
<td>disable-catch-all</td>
<td>TODO</td>
<td>-</td>
<td>Disable support for catch-all Ingresses</td>
</tr>
<tr>
<td>disable-full-test</td>
<td>TODO；默认开启</td>
<td>-</td>
<td>Disable full test of all merged ingresses at the admission stage and tests the template of the ingress being created or updated</td>
</tr>
<tr>
<td>disable-svc-external-name</td>
<td>TODO</td>
<td>-</td>
<td>Disable support for Services of type ExternalName</td>
</tr>
<tr>
<td>dynamic-configuration-retries</td>
<td>TODO</td>
<td>15</td>
<td>Number of times to retry failed dynamic configuration before failing to sync an ingress.</td>
</tr>
<tr>
<td>election-id</td>
<td>解决多副本同时更新状态，使用的选举id锁</td>
<td>ingress-controller-leader</td>
<td>Election id to use for Ingress status updates.</td>
</tr>
<tr>
<td>enable-metrics</td>
<td>开启nginx的prometheus类型性能指标，影响性能，高并发下可以考虑关闭</td>
<td>true</td>
<td>Enables the collection of NGINX metrics</td>
</tr>
<tr>
<td>enable-ssl-chain-completion</td>
<td>TODO</td>
<td>-</td>
<td>Autocomplete SSL certificate chains with missing intermediate CA certificates. Certificates uploaded to Kubernetes must have the &ldquo;Authority Information Access&rdquo; X.509 v3 extension for this to succeed.</td>
</tr>
<tr>
<td>enable-ssl-passthrough</td>
<td>TODO</td>
<td>-</td>
<td>Enable SSL Passthrough.</td>
</tr>
<tr>
<td>health-check-path</td>
<td>健康检测的url地址</td>
<td>/healthz</td>
<td>URL path of the health check endpoint. Configured inside the NGINX status server. All requests received on the port defined by the healthz-port parameter are forwarded internally to this path.</td>
</tr>
<tr>
<td>health-check-timeout</td>
<td>健康检测超时时间，秒</td>
<td>10</td>
<td>Time limit, in seconds, for a probe to health-check-path to succeed.</td>
</tr>
<tr>
<td>healthz-host</td>
<td>健康检测主机地址</td>
<td>-</td>
<td>Address to bind the healthz endpoint.</td>
</tr>
<tr>
<td>healthz-port</td>
<td>健康检测端口</td>
<td>10254</td>
<td>Port to use for the healthz endpoint.</td>
</tr>
<tr>
<td>http-port</td>
<td>接收http协议流量的端口</td>
<td>80</td>
<td>Port to use for servicing HTTP traffic.</td>
</tr>
<tr>
<td>https-port</td>
<td>接收https协议流量的端口</td>
<td>80</td>
<td>Port to use for servicing HTTPS traffic.</td>
</tr>
<tr>
<td>ingress-class</td>
<td>已被废弃；TODO</td>
<td>-</td>
<td>Name of the ingress class this controller satisfies. The class of an Ingress object is set using the annotation &ldquo;kubernetes.io/ingress.class&rdquo;. The parameter &ndash;controller-class has precedence over this.</td>
</tr>
<tr>
<td>ingress-class-by-name</td>
<td>TODO</td>
<td>TODO</td>
<td>Define if Ingress Controller should watch for Ingress Class by Name together with Controller Class</td>
</tr>
<tr>
<td>internal-logger-address</td>
<td>TODO</td>
<td>127.0.0.1:11514</td>
<td>Address to be used when binding internal syslogger</td>
</tr>
<tr>
<td>kubeconfig</td>
<td>连接api server的信息</td>
<td>-</td>
<td>Path to a kubeconfig file containing authorization and API server information.</td>
</tr>
<tr>
<td>length-buckets</td>
<td>TODO</td>
<td>-</td>
<td>Set of buckets which will be used for prometheus histogram metrics such as RequestLength, ResponseLength. ([10.000000,20.000000,30.000000,40.000000,50.000000,60.000000,70.000000,80.000000,90.000000,100.000000])</td>
</tr>
<tr>
<td>log_backtrace_at</td>
<td>TODO</td>
<td>0</td>
<td>when logging hits line file:N, emit a stack trace</td>
</tr>
<tr>
<td>log_dir</td>
<td>日志目录</td>
<td>-</td>
<td>If non-empty, write log files in this directory (no effect when -logtostderr=true)</td>
</tr>
<tr>
<td>log_file</td>
<td>日志文件名</td>
<td>-</td>
<td>If non-empty, use this log file (no effect when -logtostderr=true)</td>
</tr>
<tr>
<td>log_file_max_size</td>
<td>日志文件最大值，单位：MB</td>
<td>1800MB</td>
<td>Defines the maximum size a log file can grow to (no effect when -logtostderr=true). Unit is megabytes. If the value is 0, the maximum file size is unlimited.</td>
</tr>
<tr>
<td>logtostderr</td>
<td>日志输出到终端</td>
<td>true</td>
<td>log to standard error instead of files</td>
</tr>
<tr>
<td>maxmind-edition-ids</td>
<td>TODO</td>
<td>-</td>
<td>Maxmind edition ids to download GeoLite2 Databases. (default &ldquo;GeoLite2-City,GeoLite2-ASN&rdquo;)</td>
</tr>
<tr>
<td>maxmind-license-key</td>
<td>TODO</td>
<td>-</td>
<td>Maxmind license key to download GeoLite2 Databases.</td>
</tr>
<tr>
<td>maxmind-mirror</td>
<td>TODO</td>
<td>-</td>
<td>Maxmind mirror url (example: <a href="http://geoip.local/databases">http://geoip.local/databases</a></td>
</tr>
<tr>
<td>maxmind-retries-count</td>
<td>TODO</td>
<td>1</td>
<td>Number of attempts to download the GeoIP DB.</td>
</tr>
<tr>
<td>maxmind-retries-timeout</td>
<td>TODO</td>
<td>0s</td>
<td>Maxmind downloading delay between 1st and 2nd attempt, 0s - do not retry to download if something went wrong.</td>
</tr>
<tr>
<td>metrics-per-host</td>
<td>TODO</td>
<td>true</td>
<td>Export metrics per-host</td>
</tr>
<tr>
<td>monitor-max-batch-size</td>
<td>TODO</td>
<td>10000</td>
<td>Max batch size of NGINX metrics</td>
</tr>
<tr>
<td>one_output</td>
<td>TODO</td>
<td>TODO</td>
<td>If true, only write logs to their native severity level</td>
</tr>
<tr>
<td>post-shutdown-grace-period</td>
<td>TODO</td>
<td>10</td>
<td>Seconds to wait after the nginx process has stopped before controller exits.</td>
</tr>
<tr>
<td>profiler-port</td>
<td>控制器对外提供的profiler端口地址</td>
<td>10245</td>
<td>Port to use for expose the ingress controller Go profiler when it is enabled.</td>
</tr>
<tr>
<td>profiling</td>
<td>是否开启pprof</td>
<td>true</td>
<td>Enable profiling via web interface host:port/debug/pprof/</td>
</tr>
<tr>
<td>publish-service</td>
<td>各个 ingress.status 的 Address 地址，监听命名空间下服务，格式为：&ldquo;namespace/name&rdquo;，一般仅在公有云环境使用</td>
<td>TODO</td>
<td>Service fronting the Ingress controller. Takes the form &ldquo;namespace/name&rdquo;. When used together with update-status, the controller mirrors the address of this service&rsquo;s endpoints to the load-balancer status of all Ingress objects it satisfies.</td>
</tr>
<tr>
<td>publish-status-address</td>
<td>功能同&quot;publish-service&quot;，有人工预先分配</td>
<td>TODO</td>
<td>Customized address (or addresses, separated by comma) to set as the load-balancer status of Ingress objects this controller satisfies. Requires the update-status parameter.</td>
</tr>
<tr>
<td>report-node-internal-ip-address</td>
<td>功能同&quot;publish-service&quot;，使用当前 controler 部署节点的IP，一般在私有云使用</td>
<td>TODO</td>
<td>Set the load-balancer status of Ingress objects to internal Node addresses instead of external.</td>
</tr>
<tr>
<td>report-status-classes</td>
<td>TODO</td>
<td>TODO</td>
<td>Use status classes (2xx, 3xx, 4xx and 5xx) instead of status codes in metrics</td>
</tr>
<tr>
<td>shutdown-grace-period</td>
<td>TODO</td>
<td>TODO</td>
<td>Seconds to wait after receiving the shutdown signal, before stopping the nginx process.</td>
</tr>
<tr>
<td>size-buckets</td>
<td>TODO</td>
<td>TODO</td>
<td>Set of buckets which will be used for prometheus histogram metrics such as BytesSent (default [10.000000,100.000000,1000.000000,10000.000000,100000.000000,1000000.000000,10000000.000000])</td>
</tr>
<tr>
<td>skip_headers</td>
<td>TODO</td>
<td>TODO</td>
<td>If true, avoid header prefixes in the log messages</td>
</tr>
<tr>
<td>skip_log_headers</td>
<td>TODO</td>
<td>TODO</td>
<td>If true, avoid headers when opening log files (no effect when -logtostderr=true)</td>
</tr>
<tr>
<td>ssl-passthrough-proxy-port</td>
<td>TODO</td>
<td>442</td>
<td>Port to use internally for SSL Passthrough.</td>
</tr>
<tr>
<td>status-port</td>
<td>TODO</td>
<td>10246</td>
<td>Port to use for the lua HTTP endpoint configuration.</td>
</tr>
<tr>
<td>status-update-interval</td>
<td>TODO</td>
<td>60</td>
<td>Time interval in seconds in which the status should check if an update is required. Default is 60 seconds</td>
</tr>
<tr>
<td>stderrthreshold</td>
<td>TODO</td>
<td>2</td>
<td>logs at or above this threshold go to stderr when writing to files and stderr (no effect when -logtostderr=true or -alsologtostderr=false)</td>
</tr>
<tr>
<td>stream-port</td>
<td>TODO</td>
<td>10247</td>
<td>Port to use for the lua TCP/UDP endpoint configuration.</td>
</tr>
<tr>
<td>sync-period</td>
<td>TODO；默认关闭</td>
<td>-</td>
<td>Period at which the controller forces the repopulation of its local object stores.</td>
</tr>
<tr>
<td>sync-rate-limit</td>
<td>TODO</td>
<td>0.3</td>
<td>Define the sync frequency upper limit</td>
</tr>
<tr>
<td>tcp-services-configmap</td>
<td>nginx stream tcp代理</td>
<td>tcp-services</td>
<td>Name of the ConfigMap containing the definition of the TCP services to expose. The key in the map indicates the external port to be used. The value is a reference to a Service in the form &ldquo;namespace/name:port&rdquo;, where &ldquo;port&rdquo; can either be a port number or name.</td>
</tr>
<tr>
<td>time-buckets</td>
<td>TODO</td>
<td>TODO</td>
<td>Set of buckets which will be used for prometheus histogram metrics such as RequestTime, ResponseTime (default [0.005000,0.010000,0.025000,0.050000,0.100000,0.250000,0.500000,1.000000,2.500000,5.000000,10.000000])</td>
</tr>
<tr>
<td>udp-services-configmap</td>
<td>nginx stream udp代理</td>
<td>udp-services</td>
<td>Name of the ConfigMap containing the definition of the UDP services to expose. The key in the map indicates the external port to be used. The value is a reference to a Service in the form &ldquo;namespace/name:port&rdquo;, where &ldquo;port&rdquo; can either be a port name or number.</td>
</tr>
<tr>
<td>update-status</td>
<td>TODO</td>
<td>true</td>
<td>Update the load-balancer status of Ingress objects this controller satisfies. Requires setting the publish-service parameter to a valid Service reference.</td>
</tr>
<tr>
<td>update-status-on-shutdown</td>
<td>TODO</td>
<td>true</td>
<td>Update the load-balancer status of Ingress objects when the controller shuts down. Requires the update-status parameter.</td>
</tr>
<tr>
<td>v</td>
<td>日志级别</td>
<td>-</td>
<td>number for the log level verbosity</td>
</tr>
<tr>
<td>validating-webhook</td>
<td>准入控制器验证ingress的配置</td>
<td>TODO</td>
<td>The address to start an admission controller on to validate incoming ingresses. Takes the form &ldquo;<host>:port&rdquo;. If not provided, no admission controller is started.</td>
</tr>
<tr>
<td>validating-webhook-certificate</td>
<td>准入控制器的证书</td>
<td>TODO</td>
<td>The path of the validating webhook certificate PEM.</td>
</tr>
<tr>
<td>validating-webhook-key</td>
<td>准入控制器的证书</td>
<td>TODO</td>
<td>The path of the validating webhook key PEM.</td>
</tr>
<tr>
<td>vmodule</td>
<td>TODO</td>
<td>TODO</td>
<td>comma-separated list of pattern=N settings for file-filtered logging</td>
</tr>
<tr>
<td>watch-ingress-without-class</td>
<td>TODO</td>
<td>TODO</td>
<td>Define if Ingress Controller should also watch for Ingresses without an IngressClass or the annotation specified</td>
</tr>
<tr>
<td>watch-namespace</td>
<td>TODO</td>
<td>TODO</td>
<td>Namespace the controller watches for updates to Kubernetes objects. This includes Ingresses, Services and all configuration resources. All namespaces are watched if this parameter is left empty.</td>
</tr>
<tr>
<td>watch-namespace-selector</td>
<td>TODO</td>
<td>TODO</td>
<td>Selector selects namespaces the controller watches for updates to Kubernetes objects.</td>
</tr>
</tbody>
</table>
<h3 id="configmap-配置参数">ConfigMap 配置参数</h3>
<p>可以通过这个定制 <code>nginx.conf</code> 文件内容，里面填写的键值对对照数据结构 <code>config.go</code> 配置，由于 &ldquo;ConfigMap&rdquo; 里面只能是 <code>string</code> 类型，所以任何值需使用引号包含起来，如：<code>&quot;128&quot;</code>。如果是数组类型，则通过逗号分隔，如：<code>&quot;192.168.30.0/24, 192.168.31.0/24&quot;</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kind: ConfigMap
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nginx-configuration
</span></span><span style="display:flex;"><span>data:
</span></span><span style="display:flex;"><span>  access-log-path: <span style="color:#4e9a06">&#34;/var/log/nginx/access.log&#34;</span>
</span></span><span style="display:flex;"><span>  error-log-path: <span style="color:#4e9a06">&#34;/var/log/nginx/error.log&#34;</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>名称</th>
<th>默认值</th>
<th>可取值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>allow-backend-server-header</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否以后端返回的 &ldquo;Server&rdquo; 响应头来代替nginx ingress的值</td>
</tr>
<tr>
<td>allow-snippet-annotations</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;false&rdquo; or &ldquo;true&rdquo;</td>
<td>开启ingress配置 *-snippet 更改 nginx.conf 内容，如果用户不可信则不开放</td>
</tr>
<tr>
<td>annotation-value-word-blocklist</td>
<td>&quot;&quot;</td>
<td>字符串数组，见建议值</td>
<td>定义哪些关键字不能提供给用户配置 annotation 使用，有安全风险</td>
</tr>
<tr>
<td>hide-headers</td>
<td>&quot;&quot;</td>
<td>字符串数组</td>
<td>定义哪些请求头不返回给客户端</td>
</tr>
<tr>
<td>access-log-params</td>
<td>&quot;&quot;</td>
<td>access_log</td>
<td>nginx access_log 额外的一些参数</td>
</tr>
<tr>
<td>access-log-path</td>
<td>&ldquo;/var/log/nginx/access.log&rdquo; 指向 &ldquo;/dev/stdout&rdquo;</td>
<td>http 与 stream 共同使用</td>
<td>客户端访问日志</td>
</tr>
<tr>
<td>http-access-log-path</td>
<td>&quot;&quot;</td>
<td>http 访问日志，优先级高</td>
<td>http 访问日志</td>
</tr>
<tr>
<td>stream-access-log-path</td>
<td>&quot;&quot;</td>
<td>stream 访问日志，优先级高</td>
<td>http 访问日志</td>
</tr>
<tr>
<td>enable-access-log-for-default-backend</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否开启未匹配后端ingress的请求日志记录</td>
</tr>
<tr>
<td>error-log-path</td>
<td>&ldquo;/var/log/nginx/error.log&rdquo; 指向 &ldquo;/dev/stderr&rdquo;</td>
<td>&quot;&quot;</td>
<td>nginx 错误日志</td>
</tr>
<tr>
<td>enable-modsecurity</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否开启 modsecurity 功能</td>
</tr>
<tr>
<td>enable-owasp-modsecurity-crs</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>同上</td>
</tr>
<tr>
<td>modsecurity-snippet</td>
<td>&quot;&quot;</td>
<td>&quot;&quot;</td>
<td>TODO; 同上</td>
</tr>
<tr>
<td>client-header-buffer-size</td>
<td>&ldquo;1k&rdquo;</td>
<td>&quot;&quot;</td>
<td>客户端请求header缓存大小</td>
</tr>
<tr>
<td>client-header-timeout</td>
<td>&ldquo;60&rdquo;</td>
<td>&quot;&quot;</td>
<td>-</td>
</tr>
<tr>
<td>client-body-buffer-size</td>
<td>&ldquo;8k&rdquo;</td>
<td>&quot;&quot;</td>
<td>-</td>
</tr>
<tr>
<td>client-body-timeout</td>
<td>&ldquo;60&rdquo;</td>
<td>&quot;&quot;</td>
<td>-</td>
</tr>
<tr>
<td>disable-access-log</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; &ldquo;false&rdquo;</td>
<td>是否关闭请求日志</td>
</tr>
<tr>
<td>disable-ipv6</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否关闭ipv6监听</td>
</tr>
<tr>
<td>disable-ipv6-dns</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>关闭nginx对ipv6的解析</td>
</tr>
<tr>
<td>enable-underscores-in-headers</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>客户端提交下划线&quot;_&ldquo;的请求头是否忽略，不做传递至后端</td>
</tr>
<tr>
<td>enable-ocsp</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>TODO</td>
</tr>
<tr>
<td>ignore-invalid-headers</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>忽略异常请求头</td>
</tr>
<tr>
<td>retry-non-idempotent</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>对非幂等的请求（POST、LOCK、PATCH），如果后端错误将不进行重试</td>
</tr>
<tr>
<td>error-log-level</td>
<td>&ldquo;notice&rdquo;</td>
<td>见nginx error_log</td>
<td>错误日志级别</td>
</tr>
<tr>
<td>hsts</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>告诉浏览器必须使用https进行访问</td>
</tr>
<tr>
<td>hsts-include-subdomains</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>TODO</td>
</tr>
<tr>
<td>hsts-max-age</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>hsts-preload</td>
<td>&ldquo;false&rdquo;</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>keep-alive</td>
<td>&ldquo;75&rdquo;</td>
<td>&quot;&rdquo;</td>
<td>客户端与服务端保持连接时长，避免频繁建立tcp，设置为0则关闭</td>
</tr>
<tr>
<td>keep-alive-requests</td>
<td>&ldquo;100&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>large-client-header-buffers</td>
<td>&ldquo;4 8k&rdquo;</td>
<td>&quot;&quot;</td>
<td></td>
</tr>
<tr>
<td>log-format-escape-json</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>如果日志以json格式输出，则对一些格式进行转换</td>
</tr>
<tr>
<td>log-format-upstream</td>
<td>见日志格式默认值</td>
<td>&quot;&quot;</td>
<td>客户端请求日志格式</td>
</tr>
<tr>
<td>log-format-stream</td>
<td>见stream日志格式默认值</td>
<td>&quot;&quot;</td>
<td>客户端请求日志格式</td>
</tr>
<tr>
<td>enable-multi-accept</td>
<td>&ldquo;treu&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>TODO</td>
</tr>
<tr>
<td>max-worker-connections</td>
<td>&ldquo;16384&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>max-worker-open-files</td>
<td>&ldquo;0&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>map-hash-bucket-size</td>
<td>&ldquo;64&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>proxy-real-ip-cidr</td>
<td>&ldquo;0.0.0.0/0&rdquo;</td>
<td>字符串数组</td>
<td>配置proxy中间层地址并过滤, 用于获取真实客户端IP</td>
</tr>
<tr>
<td>proxy-set-headers</td>
<td>&quot;&quot;</td>
<td>&quot;&quot;</td>
<td>自定义传输后段的请求头</td>
</tr>
<tr>
<td>server-name-hash-max-size</td>
<td>&ldquo;1024&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>server-name-hash-bucket-size</td>
<td>&quot;&quot;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>proxy-headers-hash-max-size</td>
<td>&ldquo;512&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>proxy-headers-hash-bucket-size</td>
<td>&ldquo;64&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>reuse-port</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>TODO</td>
</tr>
<tr>
<td>plugins</td>
<td>&quot;&quot;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>server-tokens</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否返回客户端nginx的版本</td>
</tr>
<tr>
<td>use-proxy-protocol</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>是否使用 PROXY 协议，可以获取客户端IP</td>
</tr>
<tr>
<td>proxy-protocol-header-timeout</td>
<td>&ldquo;5s&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>use-gzip</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>针对 HTTP 响应是否开启 gzip 压缩</td>
</tr>
<tr>
<td>gzip-level</td>
<td>&ldquo;1&rdquo;</td>
<td>&quot;&quot;</td>
<td>gzip 压缩级别</td>
</tr>
<tr>
<td>use-geoip</td>
<td>&ldquo;true&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>开启 geoip</td>
</tr>
<tr>
<td>use-geoip2</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>开启 geoip</td>
</tr>
<tr>
<td>enable-brotli</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>使用 brotli 模块压缩</td>
</tr>
<tr>
<td>user-http2</td>
<td>&ldquo;false&rdquo;</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>开启 http2 支持</td>
</tr>
<tr>
<td>gzip-min-length</td>
<td>&ldquo;256&rdquo;</td>
<td>&quot;&quot;</td>
<td>TODO</td>
</tr>
<tr>
<td>gzip-types</td>
<td>见gzip默认压缩类型</td>
<td>&quot;&quot;</td>
<td>需要压缩的类型</td>
</tr>
<tr>
<td>worker-processes</td>
<td>&ldquo;auto&rdquo;</td>
<td>&quot;&quot;</td>
<td>开启nginx的进程数，默认等于cpu核心数</td>
</tr>
<tr>
<td>load-balance</td>
<td>&ldquo;round_robin&rdquo;</td>
<td>&ldquo;round_robin&rdquo; or &ldquo;ewma&rdquo;</td>
<td>TODO;</td>
</tr>
<tr>
<td>upstream-keepalive-connections</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>proxy-read-timeout</td>
<td>60s</td>
<td>x</td>
<td>proxy读取等待后端响应体返回的最大时间</td>
</tr>
<tr>
<td>proxy-next-upstream-tries</td>
<td>3</td>
<td>x</td>
<td>proxy读取、发送后端如果超时，重试的次数</td>
</tr>
<tr>
<td>compute-full-forwarded-for</td>
<td>false</td>
<td>&ldquo;true&rdquo; or &ldquo;false&rdquo;</td>
<td>将 remote address 附加到 X-Forwarded-For,新增X-Original-Forwarded-For 记录旧值，一般用于解决 xff 伪造</td>
</tr>
</tbody>
</table>
<ul>
<li>ingress关闭建议值</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#4e9a06">&#34;load_module,lua_package,_by_lua,location,root,proxy_pass,serviceaccount,{,},&#39;,\&#34;&#34;</span>
</span></span></code></pre></div><ul>
<li>日志格式默认值</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#000">$remote_addr</span> - <span style="color:#000">$remote_user</span> <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">$time_local</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$request</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">$status</span> <span style="color:#000">$body_bytes_sent</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_referer</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_user_agent</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">$request_length</span> <span style="color:#000">$request_time</span> <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">$proxy_upstream_name</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">$proxy_alternative_upstream_name</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#000">$upstream_addr</span> <span style="color:#000">$upstream_response_length</span> <span style="color:#000">$upstream_response_time</span> <span style="color:#000">$upstream_status</span> <span style="color:#000">$req_id</span>
</span></span></code></pre></div><ul>
<li>stream日志格式默认值</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">$remote_addr</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#000">$time_local</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#000">$protocol</span> <span style="color:#000">$status</span> <span style="color:#000">$bytes_sent</span> <span style="color:#000">$bytes_received</span> <span style="color:#000">$session_time</span>
</span></span></code></pre></div><ul>
<li>gzip默认压缩类型</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>application/atom+xml application/javascript application/x-javascript application/json application/rss+xml application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/svg+xml image/x-icon text/css text/plain text/x-component
</span></span></code></pre></div><h2 id="各个配置例子">各个配置例子</h2>
<p>有三种方式可以自定义你的Ingress Nginx：</p>
<ol>
<li>
<p>通过ConfigMap</p>
<p>更改全局的ConfigMap配置&quot;nginx-configuration&quot;，默认由参数&quot;&ndash;configmap&quot;控制。</p>
</li>
<li>
<p>通过Annotations</p>
<p>通过各个ingress的配置文件添加特定注解，控制各自的行为，注解前缀由&quot;&ndash;annotations-prefix&quot;控制。</p>
</li>
<li>
<p>自定义 nginx.tmpl 模版</p>
<p>如果以上两种方式还无法满足需要，可以通过更改nginx.conf的模版文件。</p>
</li>
</ol>
<h3 id="自定义nginx模版">自定义Nginx模版</h3>
<ul>
<li>拷贝ingress-nginx镜像内的模版内容</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/nginx/template/nginx.tmpl
</span></span></code></pre></div><ul>
<li>以nginx.tmpl创建ConfigMap资源</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: ConfigMap
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nginx-template
</span></span><span style="display:flex;"><span>  namespace: kube-system
</span></span><span style="display:flex;"><span>data:
</span></span><span style="display:flex;"><span>  nginx.tmpl: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span> :<span style="color:#ce5c00;font-weight:bold">=</span> . <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$servers</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Servers <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Cfg <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$IsIPV6Enabled</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .IsIPV6Enabled <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$healthzURI</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .HealthzURI <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$backends</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Backends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxyHeaders</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .ProxySetHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$addHeaders</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .AddHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#8f5902;font-style:italic"># Configuration checksum: {{ $all.Cfg.Checksum }}</span>
</span></span><span style="display:flex;"><span>      ......
</span></span></code></pre></div><ul>
<li>在Deployment或DaemonSet中加入模版</li>
</ul>
<p>把官方镜像里的nginx.tmpl模版文件拷贝更改，并创建为ConfigMap资源挂载覆盖默认模版。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>        volumeMounts:
</span></span><span style="display:flex;"><span>        - name: nginx-template
</span></span><span style="display:flex;"><span>          mountPath: /etc/nginx/template
</span></span><span style="display:flex;"><span>          readOnly: <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>      volumes:
</span></span><span style="display:flex;"><span>      - name: nginx-template
</span></span><span style="display:flex;"><span>        configMap:
</span></span><span style="display:flex;"><span>          name: nginx-template
</span></span><span style="display:flex;"><span>......
</span></span></code></pre></div><h3 id="代理tcp与udp流量">代理TCP与UDP流量</h3>
<p>ingres是不包含tcp、udp这块流量规范，这里是ingress-nginx添加的功能。</p>
<ul>
<li>创建tcp服务使用的ConfigMap</li>
</ul>
<blockquote>
<p>监听的cm名称由<code>--tcp-services-configmap</code>参数决定</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kind: ConfigMap
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: tcp-services
</span></span><span style="display:flex;"><span>data:
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#34;1053&#34;</span>: <span style="color:#4e9a06">&#34;kube-system/kube-dns:53&#34;</span>
</span></span></code></pre></div><p>开启1053端口，转发流量至&quot;kube-system&quot;命名空间下service为&quot;kube-dns&quot;的53端口。</p>
<ul>
<li>在ingress-nginx自动生成的配置</li>
</ul>
<p>/etc/nginx/nginx.conf</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>stream <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      ......
</span></span><span style="display:flex;"><span>      server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            preread_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                  ngx.var.proxy_upstream_name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;tcp-kube-system-kube-dns-53&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            listen                  1053<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_timeout           600s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream     on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream_timeout 600s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream_tries   3<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_pass              upstream_balancer<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      ......
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="app-root">app-root</h3>
<ul>
<li>ingress配置</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/app-root: <span style="color:#4e9a06">&#34;/test&#34;</span>
</span></span></code></pre></div><ul>
<li>nginx.tmpl模版</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.Rewrite.AppRoot<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$uri</span> <span style="color:#ce5c00;font-weight:bold">=</span> /<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">302</span> <span style="color:#000">$scheme</span>://<span style="color:#000">$http_host</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Rewrite.AppRoot <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span></code></pre></div><ul>
<li>nginx.conf生成内容</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$uri</span> <span style="color:#ce5c00;font-weight:bold">=</span> /<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">302</span> <span style="color:#000">$scheme</span>://<span style="color:#000">$http_host</span>/test<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="affinity">affinity</h3>
<ul>
<li>ingress配置</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/affinity: <span style="color:#4e9a06">&#34;cookie&#34;</span>
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/session-cookie-name: <span style="color:#4e9a06">&#34;HELLO&#34;</span>
</span></span></code></pre></div><ul>
<li>curl测试</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt; HTTP/1.1 <span style="color:#0000cf;font-weight:bold">200</span> OK
</span></span><span style="display:flex;"><span>&lt; Date: Mon, <span style="color:#0000cf;font-weight:bold">12</span> Sep <span style="color:#0000cf;font-weight:bold">2022</span> 14:05:36 GMT
</span></span><span style="display:flex;"><span>&lt; Content-Type: text/html
</span></span><span style="display:flex;"><span>&lt; Content-Length: <span style="color:#0000cf;font-weight:bold">4</span>
</span></span><span style="display:flex;"><span>&lt; Connection: keep-alive
</span></span><span style="display:flex;"><span>&lt; Set-Cookie: <span style="color:#000">HELLO</span><span style="color:#ce5c00;font-weight:bold">=</span>1662991537.226.193.550764<span style="color:#000;font-weight:bold">|</span>a6b1ec86db225f232b62b29085af45ff<span style="color:#000;font-weight:bold">;</span> <span style="color:#000">Path</span><span style="color:#ce5c00;font-weight:bold">=</span>/<span style="color:#000;font-weight:bold">;</span> HttpOnly
</span></span><span style="display:flex;"><span>&lt; Last-Modified: Mon, <span style="color:#0000cf;font-weight:bold">11</span> Dec <span style="color:#0000cf;font-weight:bold">2017</span> 03:18:39 GMT
</span></span></code></pre></div><p>具体逻辑由&quot;rootfs/etc/nginx/lua/balancer/sticky.lua&quot;实现。</p>
<h3 id="auth">auth</h3>
<ul>
<li>创建用户与密码文件</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>htpasswd -c http-auth.txt user1
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 用户: user1</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 密码: kubernetes</span>
</span></span><span style="display:flex;"><span>user1:<span style="color:#000">$apr1$ue3Fu891$xnyqlJlwcM4iWtJrAN8ZW</span>/
</span></span></code></pre></div><ul>
<li>把 http-auth.txt 转化为 k8s secret 资源</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat http-auth.txt
</span></span></code></pre></div><p>当&quot;nginx.ingress.kubernetes.io/auth-secret-type&quot;为&quot;auth-file&quot;时，替换&quot;auth&quot;对应的值</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Secret
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: basic-auth
</span></span><span style="display:flex;"><span>stringData:
</span></span><span style="display:flex;"><span>  auth: <span style="color:#000">dXNlcjE6JGFwcjEkdWUzRnU4OTEkeG55cWxKbHdjTTRpV3RKckFOOFpXLwo</span><span style="color:#ce5c00;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>type: Opaque
</span></span></code></pre></div><p>当&quot;nginx.ingress.kubernetes.io/auth-secret-type&quot;为&quot;auth-map&quot;时，替换下面&quot;user1&quot;行</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>kind: Secret
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: basic-auth
</span></span><span style="display:flex;"><span>stringData:
</span></span><span style="display:flex;"><span>  user1: <span style="color:#000">$apr1$ue3Fu891$xnyqlJlwcM4iWtJrAN8ZW</span>/
</span></span><span style="display:flex;"><span>type: Opaque
</span></span></code></pre></div><blockquote>
<blockquote>
<blockquote>
<p>这里注意&quot;secret&quot;中的内容格式由&quot;nginx.ingress.kubernetes.io/auth-secret-type&quot;确定&quot;。</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="canary">canary</h3>
<ul>
<li>基于 HTTP 请求头</li>
</ul>
<p>当仅设置 <code>nginx.ingress.kubernetes.io/canary-by-header</code> 请求头时，对应的值可取 &ldquo;always&rdquo; 或 &ldquo;never&rdquo; 分别表示流量至该副本或关闭。</p>
<p>如果需要自定义默认的 &ldquo;always&rdquo; 与 &ldquo;never&rdquo; 值，需在定义 <code>nginx.ingress.kubernetes.io/canary-by-header-value</code> 内容，然后请求匹配值才会调度。</p>
<h3 id="日志格式">日志格式</h3>
<p>json日志</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>log-format-escape-json: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>log-format-upstream: <span style="color:#4e9a06">&#39;{&#34;msec&#34;: &#34;$msec&#34;, &#34;remote_addr&#34;: &#34;$remote_addr&#34;, &#34;request_length&#34;: $request_length, &#34;request_method&#34;: &#34;$request_method&#34;, &#34;host&#34;: &#34;$host&#34;, &#34;request_uri&#34;: &#34;$request_uri&#34;, &#34;server_name&#34;: &#34;$server_name&#34;, &#34;server_addr&#34;: &#34;$server_addr&#34;, &#34;server_port&#34;: $server_port, &#34;uri&#34;: &#34;$uri&#34;, &#34;args&#34;: &#34;$args&#34;, &#34;server_protocol&#34;: &#34;$server_protocol&#34;, &#34;bytes_sent&#34;: $bytes_sent, &#34;body_bytes_sent&#34;: $body_bytes_sent, &#34;status&#34;: $status, &#34;request_time&#34;: $request_time, &#34;http_referer&#34;: &#34;$http_referer&#34;, &#34;http_user_agent&#34;: &#34;$http_user_agent&#34;, &#34;http_x_tr_user_id&#34;: &#34;$http_x_tr_user_id&#34;, &#34;http_x_tr_pv_id&#34;: &#34;$http_x_tr_pv_id&#34;, &#34;http_x_tr_request_id&#34;: &#34;$req_id&#34;, &#34;http_x_tr_rpc_id&#34;: &#34;$http_x_tr_rpc_id&#34;, &#34;proxy_upstream_name&#34;: &#34;$proxy_upstream_name&#34;, &#34;upstream_addr&#34;: &#34;$upstream_addr&#34;, &#34;upstream_response_length&#34;: &#34;$upstream_response_length&#34;, &#34;upstream_response_time&#34;: &#34;$upstream_response_time&#34;, &#34;upstream_status&#34;: &#34;$upstream_status&#34;}&#39;</span>
</span></span></code></pre></div><h3 id="客户端通过snippet自定义nginxconf配置">客户端通过snippet自定义nginx.conf配置</h3>
<p>客户端是指通过在ingress中编写annotations可以很灵活的自定义nginx.conf配置，如果是不可信用户则相当危险。</p>
<p>功能开启或关闭是在 &ldquo;nginx-configuration&rdquo; 的configmap配置，&ldquo;true&quot;是开启状态：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kind: ConfigMap
</span></span><span style="display:flex;"><span>apiVersion: v1
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  name: nginx-configuration
</span></span><span style="display:flex;"><span>data:
</span></span><span style="display:flex;"><span>  allow-snippet-annotations: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span></code></pre></div><p>可以通过以下几种注解分别自定义不同的配置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>nginx.ingress.kubernetes.io/configuration-snippet
</span></span><span style="display:flex;"><span>nginx.ingress.kubernetes.io/server-snippet
</span></span><span style="display:flex;"><span>nginx.ingress.kubernetes.io/stream-snippet
</span></span><span style="display:flex;"><span>nginx.ingress.kubernetes.io/modsecurity-snippet
</span></span></code></pre></div><ul>
<li>在各 &ldquo;server&rdquo; 下 &ldquo;location&rdquo; 自定义配置</li>
</ul>
<p>ingress注解</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/configuration-snippet: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      more_set_headers <span style="color:#4e9a06">&#34;x-tr-request-id: </span><span style="color:#000">$req_id</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>nginx.tmpl模版内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* Add any additional configuration defined */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ConfigurationSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>生成的内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            more_set_headers <span style="color:#4e9a06">&#34;Request-Id: </span><span style="color:#000">$req_id</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>在各 &ldquo;server&rdquo; 下添加自定义配置</li>
</ul>
<p>ingress注解</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/server-snippet: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$agentflag</span> 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$http_user_agent</span> ~* <span style="color:#4e9a06">&#34;(Mobile)&#34;</span> <span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87">set</span> <span style="color:#000">$agentflag</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#000">$agentflag</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">301</span> https://m.a-demo-web.site<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>nginx.tmpl模版内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.ServerSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ServerSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>生成的nginx.conf</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured for host api.a-demo-web.site</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$agentflag</span> 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$http_user_agent</span> ~* <span style="color:#4e9a06">&#34;(Mobile)&#34;</span> <span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87">set</span> <span style="color:#000">$agentflag</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#000">$agentflag</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">301</span> https://m.a-demo-web.site<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>在各 &ldquo;stream&rdquo; 下添加自定义配置</li>
</ul>
<p>ingress注解</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/stream-snippet: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        listen 8000<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_pass 127.0.0.1:80<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>nginx.tmpl模版内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>stream <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># TCP services</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$tcpServer</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .TCPBackends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ....
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># UDP services</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$udpServer</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .UDPBackends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ....
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Stream Snippets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$snippet</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .StreamSnippets <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$snippet</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>在开启 &ldquo;auth-url&rdquo; 下添加自定义配置</li>
</ul>
<p>ingress注解</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/auth-url: http://a-demo-web.site/external-auth
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/auth-snippet: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      proxy_set_header Foo-Header 42<span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><p>nginx.tmpl模版内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            internal<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$externalAuth</span>.AuthSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.AuthSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>在开启 &ldquo;modsecurity&rdquo; 下添加自定义配置</li>
</ul>
<p>ingress注解</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: networking.k8s.io/v1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/enable-modsecurity: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/modsecurity-snippet: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>      SecRuleEngine On
</span></span><span style="display:flex;"><span>      SecDebugLog /tmp/modsec_debug.log
</span></span></code></pre></div><p>nginx.tmpl模版内容</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> buildModSecurityForLocation <span style="color:#000">$all</span>.Cfg <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 各各站点的配置生成</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># internal/ingress/controller/template/template.go</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func buildModSecurityForLocation<span style="color:#ce5c00;font-weight:bold">(</span>cfg config.Configuration, location *ingress.Location<span style="color:#ce5c00;font-weight:bold">)</span> string <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        isMSEnabledInLoc :<span style="color:#ce5c00;font-weight:bold">=</span> location.ModSecurity.Enable
</span></span><span style="display:flex;"><span>        isMSEnableSetInLoc :<span style="color:#ce5c00;font-weight:bold">=</span> location.ModSecurity.EnableSet
</span></span><span style="display:flex;"><span>        isMSEnabled :<span style="color:#ce5c00;font-weight:bold">=</span> cfg.EnableModsecurity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> location.ModSecurity.Snippet !<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                buffer.WriteString<span style="color:#ce5c00;font-weight:bold">(</span>fmt.Sprintf<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">`</span>modsecurity_rules <span style="color:#4e9a06">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">%v
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">`</span>, location.ModSecurity.Snippet<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> buffer.String<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>生成的nginx.conf</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$proxy_alternative_upstream_name</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        modsecurity on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        modsecurity_rules <span style="color:#4e9a06">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        SecRuleEngine On
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        SecDebugLog /tmp/modsec_debug.log
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        &#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        client_max_body_size                    20m<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="服务端通过snippet自定义nginxconf配置">服务端通过snippet自定义nginx.conf配置</h3>
<p>服务端是通过&quot;ingress-controller&quot;启动参数<code>--configmap=$(POD_NAMESPACE)/nginx-configuration</code>所关联的&quot;ConfigMap&quot;资源来实现。</p>
<p>可以通过以下几种注解分别自定义不同的配置：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>main-snippet
</span></span><span style="display:flex;"><span>http-snippet
</span></span><span style="display:flex;"><span>server-snippet
</span></span><span style="display:flex;"><span>stream-snippet
</span></span><span style="display:flex;"><span>location-snippet
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>daemon off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># main-snippet</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.MainSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.MainSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>events <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># http-snippet</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.HTTPSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.HTTPSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># 该模版内同样包含一个&#34;server snippet&#34;，由客户端通过注解提交</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># 以下属于 {{ template &#34;SERVER&#34; serverConfig $all $server }} 内容</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.ServerSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured for host {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ServerSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># location-snippet</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$all</span>.Cfg.LocationSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.Cfg.LocationSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>        
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># 以上属于 {{ template &#34;SERVER&#34; serverConfig $all $server }} 内容</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># server-snippet</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.ServerSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ServerSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> template <span style="color:#4e9a06">&#34;CUSTOM_ERRORS&#34;</span> <span style="color:#ce5c00;font-weight:bold">(</span>buildCustomErrorDeps <span style="color:#4e9a06">&#34;upstream-default-backend&#34;</span> <span style="color:#000">$cfg</span>.CustomHTTPErrors <span style="color:#000">$all</span>.EnableMetrics <span style="color:#000">$cfg</span>.EnableModsecurity<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stream <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    ......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># stream-snippet</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># 客户端通过ingress提交注解也在次</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Stream Snippets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$snippet</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .StreamSnippets <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$snippet</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>......
</span></span></code></pre></div><h3 id="监听的几个端口">监听的几个端口</h3>
<ul>
<li>启动监听的端口</li>
</ul>
<table>
<thead>
<tr>
<th>端口</th>
<th>协议</th>
<th>参数</th>
<th>用途描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>80</td>
<td>http</td>
<td>http-port</td>
<td>xxx</td>
</tr>
<tr>
<td>443</td>
<td>https</td>
<td>https-port</td>
<td>xx</td>
</tr>
<tr>
<td>8181</td>
<td>http</td>
<td>default-server-port</td>
<td>默认服务</td>
</tr>
<tr>
<td>442</td>
<td>https</td>
<td>ssl-passthrough-proxy-port</td>
<td>xxx</td>
</tr>
<tr>
<td>10254</td>
<td>http</td>
<td>healthz-port</td>
<td>/metrics, /healthz</td>
</tr>
<tr>
<td>10245</td>
<td>http</td>
<td>profiler-port</td>
<td>仅可在 127.0.0.1 监听； /debug/pprof/</td>
</tr>
<tr>
<td>10246</td>
<td>http</td>
<td>status-port</td>
<td>仅可在 127.0.0.1 监听；/healthz, /is-dynamic-lb-initialized, /nginx_status, /configuration</td>
</tr>
<tr>
<td>10247</td>
<td>tcp</td>
<td>stream-port</td>
<td>仅可在 127.0.0.1 监听；用于更新 tcp-services 与 udp-services 后端</td>
</tr>
</tbody>
</table>
<pre tabindex="0"><code>rp := []int{
    n.cfg.ListenPorts.HTTP,
    n.cfg.ListenPorts.HTTPS,
    n.cfg.ListenPorts.SSLProxy,
    n.cfg.ListenPorts.Health,
    n.cfg.ListenPorts.Default,
    nginx.ProfilerPort,
    nginx.StatusPort,
    nginx.StreamPort,
}
</code></pre><ul>
<li>default-server-port</li>
</ul>
<p>在nginx.conf模版中实现</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># backend for when default-backend-service is not configured or it does not have endpoints</span>
</span></span><span style="display:flex;"><span>server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    listen <span style="color:#0000cf;font-weight:bold">8181</span> default_server reuseport <span style="color:#000">backlog</span><span style="color:#ce5c00;font-weight:bold">=</span>4096<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#4e9a06">&#34;internal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> 404<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>profiler-port</li>
</ul>
<p>在go代码中实现</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> conf.EnableProfiling <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    go metrics.RegisterProfiler<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;127.0.0.1&#34;</span>, nginx.ProfilerPort<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>status-port</li>
</ul>
<p>在nginx.conf模版中实现</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># default server, used for NGINX healthcheck and access to nginx stats</span>
</span></span><span style="display:flex;"><span>server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    listen 127.0.0.1:<span style="color:#ce5c00;font-weight:bold">{{</span> .StatusPort <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#4e9a06">&#34;internal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    keepalive_timeout 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    gzip off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$healthzURI</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> 200<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location /is-dynamic-lb-initialized <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location <span style="color:#ce5c00;font-weight:bold">{{</span> .StatusPath <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        stub_status on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location /configuration <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        ......
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        content_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>ngx.HTTP_NOT_FOUND<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><ul>
<li>stream-port</li>
</ul>
<p>在go代码中实现</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>streams :<span style="color:#ce5c00;font-weight:bold">=</span> make<span style="color:#ce5c00;font-weight:bold">([]</span>ingress.Backend, 0<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> _, ep :<span style="color:#ce5c00;font-weight:bold">=</span> range TCPEndpoints <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    var service *apiv1.Service
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> ep.Service !<span style="color:#ce5c00;font-weight:bold">=</span> nil <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">service</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">&amp;</span>apiv1.Service<span style="color:#ce5c00;font-weight:bold">{</span>Spec: ep.Service.Spec<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    key :<span style="color:#ce5c00;font-weight:bold">=</span> fmt.Sprintf<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;tcp-%v-%v-%v&#34;</span>, ep.Backend.Namespace, ep.Backend.Name, ep.Backend.Port.String<span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">streams</span> <span style="color:#ce5c00;font-weight:bold">=</span> append<span style="color:#ce5c00;font-weight:bold">(</span>streams, ingress.Backend<span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        Name:      key,
</span></span><span style="display:flex;"><span>        Endpoints: ep.Endpoints,
</span></span><span style="display:flex;"><span>        Port:      intstr.FromInt<span style="color:#ce5c00;font-weight:bold">(</span>ep.Port<span style="color:#ce5c00;font-weight:bold">)</span>,
</span></span><span style="display:flex;"><span>        Service:   service,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> _, ep :<span style="color:#ce5c00;font-weight:bold">=</span> range UDPEndpoints <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    var service *apiv1.Service
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> ep.Service !<span style="color:#ce5c00;font-weight:bold">=</span> nil <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">service</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">&amp;</span>apiv1.Service<span style="color:#ce5c00;font-weight:bold">{</span>Spec: ep.Service.Spec<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    key :<span style="color:#ce5c00;font-weight:bold">=</span> fmt.Sprintf<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;udp-%v-%v-%v&#34;</span>, ep.Backend.Namespace, ep.Backend.Name, ep.Backend.Port.String<span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">streams</span> <span style="color:#ce5c00;font-weight:bold">=</span> append<span style="color:#ce5c00;font-weight:bold">(</span>streams, ingress.Backend<span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        Name:      key,
</span></span><span style="display:flex;"><span>        Endpoints: ep.Endpoints,
</span></span><span style="display:flex;"><span>        Port:      intstr.FromInt<span style="color:#ce5c00;font-weight:bold">(</span>ep.Port<span style="color:#ce5c00;font-weight:bold">)</span>,
</span></span><span style="display:flex;"><span>        Service:   service,
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>buf, err :<span style="color:#ce5c00;font-weight:bold">=</span> json.Marshal<span style="color:#ce5c00;font-weight:bold">(</span>streams<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hostPort :<span style="color:#ce5c00;font-weight:bold">=</span> net.JoinHostPort<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;127.0.0.1&#34;</span>, fmt.Sprintf<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%v&#34;</span>, nginx.StreamPort<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>conn, err :<span style="color:#ce5c00;font-weight:bold">=</span> net.Dial<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;tcp&#34;</span>, hostPort<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_, <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">=</span> conn.Write<span style="color:#ce5c00;font-weight:bold">(</span>buf<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><h3 id="配置404服务后端">配置404服务后端</h3>
<p>如果请求域名未在集群中配置，则把流量返回至指定后端服务，比如官方默认的服务：</p>
<blockquote>
<blockquote>
<blockquote>
<p>建议不要开启，当该后端服务不可用时，客户端需等待超时时间后才关闭，并以504返回；
客户等待的时间为：proxy-read-timeout * proxy-next-upstream-tries</p>
</blockquote>
</blockquote>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kube-system/ingress-nginx-defaultbackend
</span></span></code></pre></div><ul>
<li>镜像与代码</li>
</ul>
<p>默认镜像</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>gcr.io/google-containers/defaultbackend:1.4
</span></span></code></pre></div><p>源代码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>https://github.com/kubernetes/ingress-gce/tree/master/cmd/404-server
</span></span></code></pre></div><blockquote>
<blockquote>
<blockquote>
<p>default backend 原始代码仓库为 ingress-nginx 之后被移到 ingress-gce 下面，<a href="https://github.com/kubernetes/ingress-nginx/pull/3156">参考</a></p>
</blockquote>
</blockquote>
</blockquote>
<ul>
<li>controller 开启</li>
</ul>
<p>在 /nginx-ingress-controller 添加 <code>--default-backend-service</code> 参数指定 <code>namespace</code> 下的 <code>service</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>args:
</span></span><span style="display:flex;"><span>- /nginx-ingress-controller
</span></span><span style="display:flex;"><span>- --default-backend-service<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>POD_NAMESPACE<span style="color:#204a87;font-weight:bold">)</span>/ingress-nginx-defaultbackend
</span></span></code></pre></div><ul>
<li>响应示例：未配置任何404服务</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
</span></span><span style="display:flex;"><span>&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></div><ul>
<li>响应示例：转发默认404服务</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>default backend - <span style="color:#0000cf;font-weight:bold">404</span>
</span></span></code></pre></div><ul>
<li>响应示例：已配置404服务，但后端不可用</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt;html&gt;
</span></span><span style="display:flex;"><span>&lt;head&gt;&lt;title&gt;504 Gateway Time-out&lt;/title&gt;&lt;/head&gt;
</span></span><span style="display:flex;"><span>&lt;body&gt;
</span></span><span style="display:flex;"><span>&lt;center&gt;&lt;h1&gt;504 Gateway Time-out&lt;/h1&gt;&lt;/center&gt;
</span></span><span style="display:flex;"><span>&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
</span></span><span style="display:flex;"><span>&lt;/body&gt;
</span></span><span style="display:flex;"><span>&lt;/html&gt;
</span></span></code></pre></div><p>需等待服务端配置的超时时间结束。</p>
<h3 id="pod内核优化">POD内核优化</h3>
<ul>
<li>未调整前</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/etc/nginx $ sysctl -a <span style="color:#000;font-weight:bold">|</span> grep kernel.core_uses_pid
</span></span><span style="display:flex;"><span>kernel.core_uses_pid <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>/etc/nginx $
</span></span><span style="display:flex;"><span>/etc/nginx $ sysctl -a <span style="color:#000;font-weight:bold">|</span> grep net.core.somaxconn
</span></span><span style="display:flex;"><span>net.core.somaxconn <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">4096</span>
</span></span><span style="display:flex;"><span>/etc/nginx $
</span></span><span style="display:flex;"><span>/etc/nginx $ sysctl -a <span style="color:#000;font-weight:bold">|</span> grep net.ipv4.ip_local_port_range
</span></span><span style="display:flex;"><span>net.ipv4.ip_local_port_range <span style="color:#ce5c00;font-weight:bold">=</span> 32768	<span style="color:#0000cf;font-weight:bold">60999</span>
</span></span><span style="display:flex;"><span>/etc/nginx $ ^C
</span></span></code></pre></div><h3 id="url重定向">URL重定向</h3>
<ul>
<li>需求</li>
</ul>
<p>针对请求地址 <code>api.a-demo-web.site/commons/cmdb/v1/host/search</code> 到后端需变更为 <code>/host/search</code>，也就是移除前缀路径 <code>/commons/cmdb/v1/</code>。</p>
<ul>
<li>实现</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>apiVersion: extensions/v1beta1
</span></span><span style="display:flex;"><span>kind: Ingress
</span></span><span style="display:flex;"><span>metadata:
</span></span><span style="display:flex;"><span>  annotations:
</span></span><span style="display:flex;"><span>    nginx.ingress.kubernetes.io/rewrite-target: <span style="color:#4e9a06">&#34;/</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>  name: commons-api
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  ingressClassName: nginx
</span></span><span style="display:flex;"><span>  rules:
</span></span><span style="display:flex;"><span>  - host: api.a-demo-web.site
</span></span><span style="display:flex;"><span>    http:
</span></span><span style="display:flex;"><span>      paths:
</span></span><span style="display:flex;"><span>      - path: /commons/cmdb/v1/<span style="color:#ce5c00;font-weight:bold">(</span>.*<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        backend:
</span></span><span style="display:flex;"><span>          serviceName: commons-cmdb-v1
</span></span><span style="display:flex;"><span>          servicePort: <span style="color:#0000cf;font-weight:bold">10080</span>
</span></span><span style="display:flex;"><span>        pathType: Prefix
</span></span></code></pre></div><p>主要添加 &ldquo;rewrite-target&rdquo; 注解，与 path 设置为正则，这里需注意下 ingress 的 &ldquo;apiVersion&rdquo;，不同版本间风格存在差异。</p>
<h3 id="防止-xff-伪造">防止 xff 伪造</h3>
<ul>
<li>功能需求</li>
</ul>
<p>客户端使用 &ldquo;X-Forwarded-For&rdquo; 自定了一些 ip 并提交了请求，此时服务端正常情况下会记录整个 ip 列表。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -v -H <span style="color:#4e9a06">&#34;X-Forwarded-For: 1.1.1.1, 2.2.2.2&#34;</span> https://www.baidu.com
</span></span></code></pre></div><p>服务端将会记录：&ldquo;1.1.1.1, 2.2.2.2, 代理IP1, 代理IP2, &hellip;&hellip;&quot;，此时希望能排除客户端自定的ip，期望为：&ldquo;代理IP1, 代理IP2, &hellip;&hellip;&rdquo;</p>
<ul>
<li>步骤实现</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>forwarded-for-header: <span style="color:#4e9a06">&#34;X-Forwarded-For&#34;</span>
</span></span><span style="display:flex;"><span>use-forwarded-headers: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>compute-full-forwarded-for: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span>proxy-real-ip-cidr: <span style="color:#4e9a06">&#34;&#34;</span>
</span></span></code></pre></div><p>配置 &ldquo;compute-full-forwarded-for&rdquo; 值为 &ldquo;true&rdquo;，则在 ingress-nginx 这里会把当前 &ldquo;X-Forwarded-For&rdquo; 请求头的值拷贝并新增至 &ldquo;X-Original-Forwarded-For&rdquo;，同时重制 &ldquo;X-Forwarded-For&rdquo; 并把此时 nginx 认为的 remote addr 写入覆盖该头。</p>
<ul>
<li>原理分析</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#000">$cfg</span>.UseForwardedHeaders <span style="color:#000">$cfg</span>.ComputeFullForwardedFor <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># We can&#39;t use $proxy_add_x_forwarded_for because the realip module</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># replaces the remote_addr too soon</span>
</span></span><span style="display:flex;"><span>    map <span style="color:#000">$http_x_forwarded_for</span> <span style="color:#000">$full_x_forwarded_for</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.UseProxyProtocol <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        default          <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_x_forwarded_for</span><span style="color:#4e9a06">, </span><span style="color:#000">$proxy_protocol_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;&#39;</span>               <span style="color:#4e9a06">&#34;</span><span style="color:#000">$proxy_protocol_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        default          <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_x_forwarded_for</span><span style="color:#4e9a06">, </span><span style="color:#000">$realip_remote_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;&#39;</span>               <span style="color:#4e9a06">&#34;</span><span style="color:#000">$realip_remote_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* definition of server-template to avoid repetitions with server-alias */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> define <span style="color:#4e9a06">&#34;SERVER&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#000">$all</span>.Cfg.UseForwardedHeaders <span style="color:#000">$all</span>.Cfg.ComputeFullForwardedFor <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Forwarded-For        <span style="color:#000">$full_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Forwarded-For        <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#8f5902;font-style:italic"># 如果同时设置了 &#34;use-forwarded-headers&#34; 与 &#34;compute-full-forwarded-for&#34; 则不进行 xff 的替换。</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#000">$all</span>.Cfg.UseForwardedHeaders <span style="color:#000">$all</span>.Cfg.ComputeFullForwardedFor <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-For        <span style="color:#000">$full_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-For        <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span></code></pre></div>
	
		<br /><hr />
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>

<div class="d-print-none">
  <h4 class="feedback--title">希望您的反馈</h4>
  <p class="feedback--question">该页面的内容对您有帮助吗?</p>
  <button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">是的</button>
  <button class="btn btn-danger mb-4 feedback--answer feedback--answer-no">没有</button>
  <p class="feedback--response feedback--response-yes">
    感谢您的支持! 如有其他建议，<a href="https://github.com/opsaid/website/issues/new">请告诉我们！</a>
  </p>
  <p class="feedback--response feedback--response-no">
    非常抱歉，您有什么改进建议？<a href="https://github.com/opsaid/website/issues/new">请告诉我们！</a>
  </p>
</div>

<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	<div class="text-muted mt-5 pt-3 border-top">
  最后修改 2023.03.06: <a href="https://github.com/opsaid/website/commit/4dd214962c5df798586e94a1a7b9eb6fe08b5ca6">feat: 添加防止 xff 伪造方式 (4dd2149)</a>
</div>

</div>


          </main>


        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-0 col-sm-0 text-xs-center order-sm-2">
        
      </div>
      <div class="col-0 col-sm-0 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col- col-sm-12 text-center py-2 order-sm-2">
        <p class="mt-2">
          <small class="text-white">&copy; 2023 The OPSaid Authors. 保留所有权利</small>
          <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>

	
		
	

          <small>|</small>

          
          <small>
            <img style="width:16px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA7SGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMjEgNzkuMTU1NzcyLCAyMDE0LzAxLzEzLTE5OjQ0OjAwICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTUtMTEtMTBUMTQ6MDQ6NTArMDg6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE1LTExLTEwVDE0OjA0OjUwKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxNS0xMS0xMFQxNDowNDo1MCswODowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6ODBiY2E5ODUtNGY5Yi02ZTRkLTlmYzktZThmNDkyNjdkZjRlPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZWRkYWU4MGMtODc3MC0xMWU1LTg0OWEtYmNmZGE2MDI4ZjJlPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6ZDAxN2I5NGUtOTRiZC0yNjQxLThmZjktYmY3YTBhMzY3N2IxPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOmQwMTdiOTRlLTk0YmQtMjY0MS04ZmY5LWJmN2EwYTM2NzdiMTwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNS0xMS0xMFQxNDowNDo1MCswODowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo4MGJjYTk4NS00ZjliLTZlNGQtOWZjOS1lOGY0OTI2N2RmNGU8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTUtMTEtMTBUMTQ6MDQ6NTArMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPgogICAgICAgICAgICA8cmRmOkJhZz4KICAgICAgICAgICAgICAgPHJkZjpsaT4zQ0I4RkVFOEMyRUJFNkU1QTREQTk3MzI4MzU0MTI0RTwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiZGRmY2Y2Zi04NzcwLTExZTUtODQ5YS1iY2ZkYTYwMjhmMmU8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6QmFnPgogICAgICAgICA8L3Bob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHBob3Rvc2hvcDpJQ0NQcm9maWxlPnNSR0IgSUVDNjE5NjYtMi4xPC9waG90b3Nob3A6SUNDUHJvZmlsZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MjA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MjA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu6JurQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAABRFJREFUeNpE1OtvW/Udx/H3ufj4+Ph2nDh2vLgrTSPaFNqGtd0Gy9LRTVymNoNM6ihCaEwdQ5sYAo0HTOwBYg/Yk0pDiG3qmLSiPtjGJERbdZSQaUArykXt1la9hDRNY6dpYsexj30uPj7ntwcVyT/w0ucrfT5fSQgBdguAEBlZhDhaiVikF2j22lfPjP77+Kc/9ZyO9p37th7s2rLlbegveZ4g6jggS4AMAKkkkhAC366DJJADgaJlgA/unTx+4qmT/7oyKpxJfdYzUDIma7M6TsXoDH+3/8jgnrG/iOC2o8JrIiQJECjpvlt0Q7JoimWEkQHN1Sf+8MbE40+O7226M/rtCYX9+k2e0me55+48XXfn1f1PvvfwiVdfOSLFlKitSbh8hq9+DitZFRlZSaHK1aJ35uV3f3+4zr79/fy42CD9pwtULwdUpwLqu//ID4JzPHPoEQ7+00dc/vM/Eoary3oCPR5dBROeRTxaH7x+9MWpkd3nRsyBPL/InmP6cAN5jUlgtcELkXpMTj19kr3GGfLfuovv7T62Z/GjN67aM2c3XHz/nVUw6jmo7ruJI5eT2idz23lwu0XzbAP5eh3JjBJdCnBP3iSyrhu96VD562nG7m8z8cUm3vwwKCSkVgx5aBWsL1aK4cfvHwilGKg2KWuOxjxEAh+WXKT1Bto2E/lGC42QyrRDX5cHkkStKRPtUQ9sHB5btwLOXHrvh+1yeTiT0KATRRQKZId7aSKw7ukm2Fck8dIQxjNbkHsMctuytOw2CEEhZ0Dp7L1Ls6d+sgIaicxgw/Lp73FB7+bEaQN1V4rqnrUEZQvpfy3sYzfxp5fRnh+m69mtvHWoBsQZ2qzSmlrALU0VV8BwaW5Po6ZyZ9Gi+HWN19+M859XSgztKJA2ktgXaoQLHu65GsnyMudfvsKrh6Lkh0w299WplD38pUvDK6CstkyrIZNavMLe+wM6fgL/6Dzdf/scuS9Cu0chzKlkdxUoTFylcvA8rbbC2GiEZHUSq6GiJuUIgAoQM746Lm+4Nhrk+3jiGxYH+np4vTyIP3uB7uokcjqGc6GGNZCjnCnwdzkGKZMnvrlAJ1nEvEPCyKw5tgKCnBMNwdyUxZ2D0/z2V9t48fkRjlqboeEzalfpMmXeOpakiQFkeO7nOjsGJpmbBFybsGNtXQFVs729k8zjz/uUFi7yy+EoY+NxJo7bXJK38MCmLyjEKnSO9NGuOazZaPDrB65x89Q1bF9Hz2qoprYRuPUcvOYnj1ZP/+6wM9/Gq/hQmmH9Q0NE8zoEVYKqSnPBIb2uC9Z2Q6nC9NuXcZJZEv0JYr0G6YF9O7XM9z+QhBAAdFr/fWzp/IHXAtdJVz6cR40LencOEiw5+HYL2dDRu+JIWoTqqSk6gUp6+3p8l2p6w8gjcTM1Lmn33TrZd2ZwFp2yOx9z9HyYzu8aIKi3CKwGGBqKZqLFoL3cpFWqoa/tRi/m8ZZt3LIlYmuaKKkUsS9rI9pXUfjohdzXkr2RTAGvHhIGKmGg4C5aIELa1TrNyUUkJQKShHujQiQmk/92IasZ1s9Ch9Uta0qKaPeOhyw7/ZpdKrU0ZZlUrkNEstEkH8VbRjgOyY1ZUgMpZK2JmtaQMr3XO+pdv1GN23+kaIus1kb4SBHVblTjTzsX8y859cUHPX9251c29WwKLSmhm3KXGkti3eB6rMe01dzI2aWphXFnpnaib2culBQFEbgA/H8ALiI3EysggNoAAAAASUVORK5CYII="></img>
            <a href="http://www.beian.gov.cn">闽公网安备 35092202000170号</a>
          </small>
          <small>|</small>
          <small>
            <a href="https://beian.miit.gov.cn/#/Integrated/recordQuery" target="_blank" rel="noopener">闽ICP备2022001029号</a>
          </small>
          
        </p>

        
        <p class="mt-2">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
          </a>
          <small>本作品采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可。</small>
        </p>
        

      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>


















<script src="/js/main.min.aa9f4c5dae6a98b2c46277f4c56f1673a2b000d1756ce4ffae93784cab25e6d5.js" integrity="sha256-qp9MXa5qmLLEYnf0xW8Wc6KwANF1bOT/rpN4TKsl5tU=" crossorigin="anonymous"></script>




  </body>
</html>
