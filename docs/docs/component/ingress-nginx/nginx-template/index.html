<!doctype html>
<html lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.102.3" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Nginx Template | OPSaid</title>
<meta name="description" content="Ingress Nginx 模版内容
基于 controller-v1.3.1 版本
模版内容
{{ $all := . }}
{{ $servers := .Servers }}
{{ $cfg := .Cfg }}
{{ $IsIPV6Enabled := .IsIPV6Enabled }} …">
<meta property="og:title" content="Nginx Template" />
<meta property="og:description" content="Ingress Nginx 模版内容 基于 controller-v1.3.1 版本
模版内容 {{ $all := . }} {{ $servers := .Servers }} {{ $cfg := .Cfg }} {{ $IsIPV6Enabled := .IsIPV6Enabled }} {{ $healthzURI := .HealthzURI }} {{ $backends := .Backends }} {{ $proxyHeaders := .ProxySetHeaders }} {{ $addHeaders := .AddHeaders }} # Configuration checksum: {{ $all.Cfg.Checksum }} # setup custom paths that do not require root access pid {{ .PID }}; {{ if $cfg.UseGeoIP2 }} load_module /etc/nginx/modules/ngx_http_geoip2_module." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/component/ingress-nginx/nginx-template/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-09-22T11:08:05+08:00" />
<meta property="article:modified_time" content="2023-02-13T16:48:32+08:00" /><meta property="og:site_name" content="OPSaid" />

<meta itemprop="name" content="Nginx Template">
<meta itemprop="description" content="Ingress Nginx 模版内容 基于 controller-v1.3.1 版本
模版内容 {{ $all := . }} {{ $servers := .Servers }} {{ $cfg := .Cfg }} {{ $IsIPV6Enabled := .IsIPV6Enabled }} {{ $healthzURI := .HealthzURI }} {{ $backends := .Backends }} {{ $proxyHeaders := .ProxySetHeaders }} {{ $addHeaders := .AddHeaders }} # Configuration checksum: {{ $all.Cfg.Checksum }} # setup custom paths that do not require root access pid {{ .PID }}; {{ if $cfg.UseGeoIP2 }} load_module /etc/nginx/modules/ngx_http_geoip2_module."><meta itemprop="datePublished" content="2022-09-22T11:08:05+08:00" />
<meta itemprop="dateModified" content="2023-02-13T16:48:32+08:00" />
<meta itemprop="wordCount" content="5380">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Nginx Template"/>
<meta name="twitter:description" content="Ingress Nginx 模版内容 基于 controller-v1.3.1 版本
模版内容 {{ $all := . }} {{ $servers := .Servers }} {{ $cfg := .Cfg }} {{ $IsIPV6Enabled := .IsIPV6Enabled }} {{ $healthzURI := .HealthzURI }} {{ $backends := .Backends }} {{ $proxyHeaders := .ProxySetHeaders }} {{ $addHeaders := .AddHeaders }} # Configuration checksum: {{ $all.Cfg.Checksum }} # setup custom paths that do not require root access pid {{ .PID }}; {{ if $cfg.UseGeoIP2 }} load_module /etc/nginx/modules/ngx_http_geoip2_module."/>




<link rel="preload" href="/scss/main.min.3a569f361d0fc9e237d549f271b0c5c6ac0bb47fe57679fb670a9178c0cec1fb.css" as="style">
<link href="/scss/main.min.3a569f361d0fc9e237d549f271b0c5c6ac0bb47fe57679fb670a9178c0cec1fb.css" rel="stylesheet" integrity="">

<script
  src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?29e809336f76b78232deae2a6d1857ba";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>




<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168659370-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="font-weight-bold">OPSaid</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
        <a  class="nav-link" href="/docs/" ><span>Documentation</span></a>
				
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
        <a  class="nav-link" href="https://github.com/opsaid" target="_blank" ><span>GitHub</span></a>
				
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            

  

<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  

  <nav class="collapse td-sidebar-nav foldable-menu" id="td-section-nav">
    
    
    
    
    

    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
        




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docs">
      <input type="checkbox" id="docs-check" checked/>
      <label for="docs-check" ><a href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section tree-root">Documentation</a></label>
      
        
        
      
      <ul class="ul-1">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdeploy-k8s">
      <input type="checkbox" id="docsdeploy-k8s-check"/>
      <label for="docsdeploy-k8s-check" ><a href="/docs/deploy-k8s/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 集群部署</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdeploy-k8squickstart">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdeploy-k8squickstart-a" href="/docs/deploy-k8s/quickstart/">快速开始</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdeploy-k8sbinary">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdeploy-k8sbinary-a" href="/docs/deploy-k8s/binary/">官方镜像</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconcepts">
      <input type="checkbox" id="docsconcepts-check"/>
      <label for="docsconcepts-check" ><a href="/docs/concepts/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 数据结构</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsworkloads">
      <input type="checkbox" id="docsconceptsworkloads-check"/>
      <label for="docsconceptsworkloads-check" ><a href="/docs/concepts/workloads/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">工作负载</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-a" href="/docs/concepts/workloads/pods/">Pod</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-volume">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-volume-a" href="/docs/concepts/workloads/pods-volume/">Pod Volume</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-container">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-container-a" href="/docs/concepts/workloads/pods-container/">Pod Container</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-security">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-security-a" href="/docs/concepts/workloads/pods-security/">Pod Security</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadspods-affinity">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadspods-affinity-a" href="/docs/concepts/workloads/pods-affinity/">Pod Affinity</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsdeployments">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsdeployments-a" href="/docs/concepts/workloads/deployments/">Deployment</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsstatefulsets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsstatefulsets-a" href="/docs/concepts/workloads/statefulsets/">StatefulSet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsdaemonsets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsdaemonsets-a" href="/docs/concepts/workloads/daemonsets/">DaemonSet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsjobs">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsjobs-a" href="/docs/concepts/workloads/jobs/">Job</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadscronjobs">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadscronjobs-a" href="/docs/concepts/workloads/cronjobs/">CronJob</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsworkloadsreplicationcontrollers">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsworkloadsreplicationcontrollers-a" href="/docs/concepts/workloads/replicationcontrollers/">ReplicationController</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsnetwork">
      <input type="checkbox" id="docsconceptsnetwork-check"/>
      <label for="docsconceptsnetwork-check" ><a href="/docs/concepts/network/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">网络资源</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkingress">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkingress-a" href="/docs/concepts/network/ingress/">Ingress</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkservice">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkservice-a" href="/docs/concepts/network/service/">Service</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkendpoints">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkendpoints-a" href="/docs/concepts/network/endpoints/">Endpoints</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsnetworkendpoint-slice">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsnetworkendpoint-slice-a" href="/docs/concepts/network/endpoint-slice/">EndpointSlice</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptsconfiguration">
      <input type="checkbox" id="docsconceptsconfiguration-check"/>
      <label for="docsconceptsconfiguration-check" ><a href="/docs/concepts/configuration/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">配置资源</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsconfigurationconfigmaps">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsconfigurationconfigmaps-a" href="/docs/concepts/configuration/configmaps/">ConfigMap</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptsconfigurationsecrets">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptsconfigurationsecrets-a" href="/docs/concepts/configuration/secrets/">Secret</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsconceptskubeadm">
      <input type="checkbox" id="docsconceptskubeadm-check"/>
      <label for="docsconceptskubeadm-check" ><a href="/docs/concepts/kubeadm/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubeadm</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadminit">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadminit-a" href="/docs/concepts/kubeadm/init/">Init</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmcluster">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmcluster-a" href="/docs/concepts/kubeadm/cluster/">Cluster</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmjoin">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmjoin-a" href="/docs/concepts/kubeadm/join/">Join</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmkubelet">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmkubelet-a" href="/docs/concepts/kubeadm/kubelet/">Kubelet</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsconceptskubeadmkube-proxy">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsconceptskubeadmkube-proxy-a" href="/docs/concepts/kubeadm/kube-proxy/">Kube Proxy</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docscomponent">
      <input type="checkbox" id="docscomponent-check" checked/>
      <label for="docscomponent-check" ><a href="/docs/component/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">K8S 基础组件</a></label>
      
        
        
      
      <ul class="ul-2">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-apiserver">
      <input type="checkbox" id="docscomponentkube-apiserver-check"/>
      <label for="docscomponentkube-apiserver-check" ><a href="/docs/component/kube-apiserver/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-apiserver</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-apiserverconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-apiserverconfig-a" href="/docs/component/kube-apiserver/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-controller-manager">
      <input type="checkbox" id="docscomponentkube-controller-manager-check"/>
      <label for="docscomponentkube-controller-manager-check" ><a href="/docs/component/kube-controller-manager/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-controller-manager</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-controller-managerconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-controller-managerconfig-a" href="/docs/component/kube-controller-manager/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-scheduler">
      <input type="checkbox" id="docscomponentkube-scheduler-check"/>
      <label for="docscomponentkube-scheduler-check" ><a href="/docs/component/kube-scheduler/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-scheduler</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-schedulerconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-schedulerconfig-a" href="/docs/component/kube-scheduler/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkubelet">
      <input type="checkbox" id="docscomponentkubelet-check"/>
      <label for="docscomponentkubelet-check" ><a href="/docs/component/kubelet/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kubelet</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkubeletconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkubeletconfig-a" href="/docs/component/kubelet/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentkube-proxy">
      <input type="checkbox" id="docscomponentkube-proxy-check"/>
      <label for="docscomponentkube-proxy-check" ><a href="/docs/component/kube-proxy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">kube-proxy</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentkube-proxyconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentkube-proxyconfig-a" href="/docs/component/kube-proxy/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentcontainers">
      <input type="checkbox" id="docscomponentcontainers-check"/>
      <label for="docscomponentcontainers-check" ><a href="/docs/component/containers/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">containers</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentcontainerscontainerd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentcontainerscontainerd-a" href="/docs/component/containers/containerd/">Containerd</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentoauth2-proxy">
      <input type="checkbox" id="docscomponentoauth2-proxy-check"/>
      <label for="docscomponentoauth2-proxy-check" ><a href="/docs/component/oauth2-proxy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">oauth2 proxy</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentoauth2-proxyconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentoauth2-proxyconfig-a" href="/docs/component/oauth2-proxy/config/">参数配置</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscomponentthanos">
      <input type="checkbox" id="docscomponentthanos-check"/>
      <label for="docscomponentthanos-check" ><a href="/docs/component/thanos/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Thanos</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosquery-frontend">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosquery-frontend-a" href="/docs/component/thanos/query-frontend/">Query Frontend</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosquery">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosquery-a" href="/docs/component/thanos/query/">Query</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosreceiver">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosreceiver-a" href="/docs/component/thanos/receiver/">Receiver</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosconfig">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosconfig-a" href="/docs/component/thanos/config/">Config</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscomponentthanosrule">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentthanosrule-a" href="/docs/component/thanos/rule/">Rule</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib active-path" id="docscomponentingress-nginx">
      <input type="checkbox" id="docscomponentingress-nginx-check" checked/>
      <label for="docscomponentingress-nginx-check" ><a href="/docs/component/ingress-nginx/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Ingress Nginx</a></label>
      
        
        
      
      <ul class="ul-3">

        
          
            
              
              
              
              
                <li class="without-sib" id="m-docscomponentingress-nginxuser-guide">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscomponentingress-nginxuser-guide-a" href="/docs/component/ingress-nginx/user-guide/">User guide</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib active-path" id="m-docscomponentingress-nginxnginx-template">
                  <span  id="td-sidebar-nav-active-item" >
                    
                      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-docscomponentingress-nginxnginx-template-a" href="/docs/component/ingress-nginx/nginx-template/">Nginx Template</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevops">
      <input type="checkbox" id="docsdevops-check"/>
      <label for="docsdevops-check" ><a href="/docs/devops/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">流程与自动化</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopsgitlab">
      <input type="checkbox" id="docsdevopsgitlab-check"/>
      <label for="docsdevopsgitlab-check" ><a href="/docs/devops/gitlab/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Gitlab</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopsgitlabgiltab-ci">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopsgitlabgiltab-ci-a" href="/docs/devops/gitlab/giltab-ci/">Runner</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopskubeadm">
      <input type="checkbox" id="docsdevopskubeadm-check"/>
      <label for="docsdevopskubeadm-check" ><a href="/docs/devops/kubeadm/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Kubeadm</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopskubeadmetcd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopskubeadmetcd-a" href="/docs/devops/kubeadm/etcd/">Etcd</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdevopspackages">
      <input type="checkbox" id="docsdevopspackages-check"/>
      <label for="docsdevopspackages-check" ><a href="/docs/devops/packages/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用打包</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackageskaniko">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackageskaniko-a" href="/docs/devops/packages/kaniko/">Kaniko</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackagesmulti-arch">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackagesmulti-arch-a" href="/docs/devops/packages/multi-arch/">Multi Arch</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdevopspackagesfpm">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdevopspackagesfpm-a" href="/docs/devops/packages/fpm/">Fpm</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdev-framework">
      <input type="checkbox" id="docsdev-framework-check"/>
      <label for="docsdev-framework-check" ><a href="/docs/dev-framework/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用开发框架</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docsdev-frameworkgo">
      <input type="checkbox" id="docsdev-frameworkgo-check"/>
      <label for="docsdev-frameworkgo-check" ><a href="/docs/dev-framework/go/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Go 语言</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docsdev-frameworkgogrpc-kit">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdev-frameworkgogrpc-kit-a" href="/docs/dev-framework/go/grpc-kit/">gRPC Kit</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitor">
      <input type="checkbox" id="docscloud-monitor-check"/>
      <label for="docscloud-monitor-check" ><a href="/docs/cloud-monitor/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">监控告警配置</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitorpreset-metrics">
      <input type="checkbox" id="docscloud-monitorpreset-metrics-check"/>
      <label for="docscloud-monitorpreset-metrics-check" ><a href="/docs/cloud-monitor/preset-metrics/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">预设指标</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsnode-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsnode-exporter-a" href="/docs/cloud-monitor/preset-metrics/node-exporter/">Node Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsingress-nginx">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsingress-nginx-a" href="/docs/cloud-monitor/preset-metrics/ingress-nginx/">Ingress Nginx</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsburrow-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsburrow-exporter-a" href="/docs/cloud-monitor/preset-metrics/burrow-exporter/">Kafka consumer lag</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskafka-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskafka-exporter-a" href="/docs/cloud-monitor/preset-metrics/kafka-exporter/">Kafka Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricszookeeper-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricszookeeper-exporter-a" href="/docs/cloud-monitor/preset-metrics/zookeeper-exporter/">ZooKeeper Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricsetcd-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricsetcd-exporter-a" href="/docs/cloud-monitor/preset-metrics/etcd-exporter/">Etcd Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskube-metrics-server">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskube-metrics-server-a" href="/docs/cloud-monitor/preset-metrics/kube-metrics-server/">Kube Metrics Server</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitorpreset-metricskube-state-metrics">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitorpreset-metricskube-state-metrics-a" href="/docs/cloud-monitor/preset-metrics/kube-state-metrics/">Kube State Metrics</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscloud-monitoralert-rules">
      <input type="checkbox" id="docscloud-monitoralert-rules-check"/>
      <label for="docscloud-monitoralert-rules-check" ><a href="/docs/cloud-monitor/alert-rules/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">告警规则</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-rulesnode-exporter">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-rulesnode-exporter-a" href="/docs/cloud-monitor/alert-rules/node-exporter/">Node Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-rulesetcd">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-rulesetcd-a" href="/docs/cloud-monitor/alert-rules/etcd/">Etcd Exporter</a>
                    
                  </span>
                  
                </li>
            
          
        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscloud-monitoralert-ruleskube-state-metrics">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscloud-monitoralert-ruleskube-state-metrics-a" href="/docs/cloud-monitor/alert-rules/kube-state-metrics/">Kube State Metrics</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscase-studies">
      <input type="checkbox" id="docscase-studies-check"/>
      <label for="docscase-studies-check" ><a href="/docs/case-studies/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">应用案例研究</a></label>
      
        
        
      
      <ul class="ul-2 collapsed">

        
          
            
              




















  
    <li class="section td-sidebar-nav__section-title td-sidebar-nav__section with-sib collapsed" id="docscase-studiesapp-deploy">
      <input type="checkbox" id="docscase-studiesapp-deploy-check"/>
      <label for="docscase-studiesapp-deploy-check" ><a href="/docs/case-studies/app-deploy/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">服务部署</a></label>
      
        
        
      
      <ul class="ul-3 collapsed">

        
          
            
              
              
              
              
                <li class="without-sib collapsed" id="m-docscase-studiesapp-deployphp-on-k8s">
                  <span >
                    
                      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscase-studiesapp-deployphp-on-k8s-a" href="/docs/case-studies/app-deploy/php-on-k8s/">PHP 在 K8S 上</a>
                    
                  </span>
                  
                </li>
            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

            
          
        

      </ul>
    </li>
  

    </ul>
  </nav>
</div>



<script>
  var activeElement = document.getElementById('td-sidebar-nav-active-item');
  var topPos = activeElement.offsetTop;
  var scrollElement = document.getElementById('td-section-nav');
  var topCor = scrollElement.offsetTop;
  var heightCor = scrollElement.clientHeight;
  var scrollValue = topPos-topCor-heightCor/2;
  scrollElement.scrollTop = scrollValue;
</script>



          </aside>


          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">




</div>

            





            

	
		
			
		
		



  
  

	
		
			
		
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="/docs/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/component/">K8S 基础组件</a>
  </li>
  <li class="breadcrumb-item">
    <a href="/docs/component/ingress-nginx/">Ingress Nginx</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="/docs/component/ingress-nginx/nginx-template/">Nginx Template</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Nginx Template</h1>
	
	<header class="article-meta">
		
		
			
				


			
				


			
		
		
			<p class="reading-time"><i class="fa fa-clock" aria-hidden="true"></i>&nbsp; 26 分钟阅读 &nbsp;</p>

		
	</header>    
	<h2 id="ingress-nginx-模版内容">Ingress Nginx 模版内容</h2>
<p>基于 controller-v1.3.1 版本</p>
<h2 id="模版内容">模版内容</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span> :<span style="color:#ce5c00;font-weight:bold">=</span> . <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$servers</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Servers <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Cfg <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$IsIPV6Enabled</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .IsIPV6Enabled <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$healthzURI</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .HealthzURI <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$backends</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Backends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxyHeaders</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .ProxySetHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$addHeaders</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .AddHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Configuration checksum: {{ $all.Cfg.Checksum }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># setup custom paths that do not require root access</span>
</span></span><span style="display:flex;"><span>pid <span style="color:#ce5c00;font-weight:bold">{{</span> .PID <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.UseGeoIP2 <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_geoip2_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.EnableBrotli <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_brotli_filter_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_brotli_static_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>shouldLoadInfluxDBModule <span style="color:#000">$servers</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_influxdb_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>shouldLoadAuthDigestModule <span style="color:#000">$servers</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_auth_digest_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>shouldLoadModSecurityModule <span style="color:#000">$cfg</span> <span style="color:#000">$servers</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_modsecurity_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>shouldLoadOpentracingModule <span style="color:#000">$cfg</span> <span style="color:#000">$servers</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>load_module /etc/nginx/modules/ngx_http_opentracing_module.so<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>daemon off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>worker_processes <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.WorkerProcesses <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.WorkerCPUAffinity<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>worker_cpu_affinity <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.WorkerCPUAffinity <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>worker_rlimit_nofile <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.MaxWorkerOpenFiles <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* http://nginx.org/en/docs/ngx_core_module.html#worker_shutdown_timeout */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* avoid waiting too long during a reload */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>worker_shutdown_timeout <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.WorkerShutdownTimeout <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.MainSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.MainSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>events <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    multi_accept        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.EnableMultiAccept <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    worker_connections  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.MaxWorkerConnections <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    use                 epoll<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$index</span> , <span style="color:#000">$v</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.DebugConnections <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    debug_connection    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$v</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>http <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    lua_package_path <span style="color:#4e9a06">&#34;/etc/nginx/lua/?.lua;;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> buildLuaSharedDictionaries <span style="color:#000">$cfg</span> <span style="color:#000">$servers</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    init_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        collectgarbage<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;collect&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        -- init modules
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">local</span> ok, res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;lua_ingress&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">lua_ingress</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>          lua_ingress.set_config<span style="color:#ce5c00;font-weight:bold">({{</span> configForLua <span style="color:#000">$all</span> <span style="color:#ce5c00;font-weight:bold">}})</span>
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;configuration&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">configuration</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>          configuration.prohibited_localhost_port <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;{{ .StatusPort }}&#39;</span>
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;balancer&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">balancer</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.EnableMetrics <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;monitor&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">monitor</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;certificate&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">certificate</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>          certificate.is_ocsp_stapling_enabled <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.EnableOCSP <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;plugins&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">plugins</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>        -- load all plugins that<span style="color:#4e9a06">&#39;ll be used here
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        plugins.init({ {{ range  $idx, $plugin := $cfg.Plugins }}{{ if $idx }},{{ end }}{{ $plugin | quote }}{{ end }} })
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    init_worker_by_lua_block {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        lua_ingress.init_worker()
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        balancer.init_worker()
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ if $all.EnableMetrics }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        monitor.init_worker({{ $all.MonitorMaxBatchSize }})
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        plugins.run()
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* Enable the real_ip module only if we use either X-Forwarded headers or Proxy Protocol. */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* we use the value of the real IP for the geo_ip module */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if or (or $cfg.UseForwardedHeaders $cfg.UseProxyProtocol) $cfg.EnableRealIp }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.UseProxyProtocol }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    real_ip_header      proxy_protocol;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    real_ip_header      {{ $cfg.ForwardedForHeader }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    real_ip_recursive   on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ range $trusted_ip := $cfg.ProxyRealIPCIDR }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    set_real_ip_from    {{ $trusted_ip }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $all.Cfg.EnableModsecurity }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    modsecurity on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if (not (empty $all.Cfg.ModsecuritySnippet)) }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    modsecurity_rules &#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.Cfg.ModsecuritySnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#4e9a06">&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    modsecurity_rules_file /etc/nginx/modsecurity/modsecurity.conf;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $all.Cfg.EnableOWASPCoreRules }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    modsecurity_rules_file /etc/nginx/owasp-modsecurity-crs/nginx-modsecurity.conf;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.UseGeoIP }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* databases used to determine the country depending on the client IP address */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* http://nginx.org/en/docs/http/ngx_http_geoip_module.html */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* this is require to calculate traffic for individual country using GeoIP in the status page */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip_country       /etc/nginx/geoip/GeoIP.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip_city          /etc/nginx/geoip/GeoLiteCity.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip_org           /etc/nginx/geoip/GeoIPASNum.dat;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip_proxy_recursive on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.UseGeoIP2 }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # https://github.com/leev/ngx_http_geoip2_module#example-usage
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ range $index, $file := $all.MaxmindEditionFiles }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoLite2-Country.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoLite2-Country.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_country_code source=$remote_addr country iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_country_name source=$remote_addr country names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_continent_code source=$remote_addr continent code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_continent_name source=$remote_addr continent names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-Country.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-Country.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_country_code source=$remote_addr country iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_country_name source=$remote_addr country names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_continent_code source=$remote_addr continent code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_continent_name source=$remote_addr continent names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoLite2-City.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoLite2-City.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city_country_code source=$remote_addr country iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city_country_name source=$remote_addr country names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city source=$remote_addr city names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_postal_code source=$remote_addr postal code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_dma_code source=$remote_addr location metro_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_latitude source=$remote_addr location latitude;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_longitude source=$remote_addr location longitude;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_time_zone source=$remote_addr location time_zone;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_region_code source=$remote_addr subdivisions 0 iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_region_name source=$remote_addr subdivisions 0 names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_subregion_code source=$remote_addr subdivisions 1 iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_subregion_name source=$remote_addr subdivisions 1 names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-City.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-City.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city_country_code source=$remote_addr country iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city_country_name source=$remote_addr country names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_city source=$remote_addr city names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_postal_code source=$remote_addr postal code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_dma_code source=$remote_addr location metro_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_latitude source=$remote_addr location latitude;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_longitude source=$remote_addr location longitude;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_time_zone source=$remote_addr location time_zone;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_region_code source=$remote_addr subdivisions 0 iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_region_name source=$remote_addr subdivisions 0 names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_subregion_code source=$remote_addr subdivisions 1 iso_code;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_subregion_name source=$remote_addr subdivisions 1 names en;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoLite2-ASN.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoLite2-ASN.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_asn source=$remote_addr autonomous_system_number;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_org source=$remote_addr autonomous_system_organization;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-ASN.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-ASN.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_asn source=$remote_addr autonomous_system_number;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_org source=$remote_addr autonomous_system_organization;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-ISP.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-ISP.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_isp source=$remote_addr isp;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_isp_org source=$remote_addr organization;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_asn source=$remote_addr default=0 autonomous_system_number;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-Connection-Type.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-Connection-Type.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_connection_type connection_type;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if eq $file &#34;GeoIP2-Anonymous-IP.mmdb&#34; }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    geoip2 /etc/nginx/geoip/GeoIP2-Anonymous-IP.mmdb {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_anon source=$remote_addr is_anonymous;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_anonymous source=$remote_addr default=0 is_anonymous;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_anonymous_vpn source=$remote_addr default=0 is_anonymous_vpn;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_hosting_provider source=$remote_addr default=0 is_hosting_provider;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_public_proxy source=$remote_addr default=0 is_public_proxy;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        $geoip2_is_tor_exit_node source=$remote_addr default=0 is_tor_exit_node;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    aio                 threads;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    aio_write           on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    tcp_nopush          on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    tcp_nodelay         on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    log_subrequest      on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    reset_timedout_connection on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    keepalive_timeout  {{ $cfg.KeepAlive }}s;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    keepalive_requests {{ $cfg.KeepAliveRequests }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    client_body_temp_path           /tmp/nginx/client-body;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    fastcgi_temp_path               /tmp/nginx/fastcgi-temp;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    proxy_temp_path                 /tmp/nginx/proxy-temp;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    ajp_temp_path                   /tmp/nginx/ajp-temp;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    client_header_buffer_size       {{ $cfg.ClientHeaderBufferSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    client_header_timeout           {{ $cfg.ClientHeaderTimeout }}s;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    large_client_header_buffers     {{ $cfg.LargeClientHeaderBuffers }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    client_body_buffer_size         {{ $cfg.ClientBodyBufferSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    client_body_timeout             {{ $cfg.ClientBodyTimeout }}s;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    http2_max_field_size            {{ $cfg.HTTP2MaxFieldSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    http2_max_header_size           {{ $cfg.HTTP2MaxHeaderSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    http2_max_requests              {{ $cfg.HTTP2MaxRequests }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    http2_max_concurrent_streams    {{ $cfg.HTTP2MaxConcurrentStreams }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    types_hash_max_size             2048;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    server_names_hash_max_size      {{ $cfg.ServerNameHashMaxSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    server_names_hash_bucket_size   {{ $cfg.ServerNameHashBucketSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    map_hash_bucket_size            {{ $cfg.MapHashBucketSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    proxy_headers_hash_max_size     {{ $cfg.ProxyHeadersHashMaxSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    proxy_headers_hash_bucket_size  {{ $cfg.ProxyHeadersHashBucketSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    variables_hash_bucket_size      {{ $cfg.VariablesHashBucketSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    variables_hash_max_size         {{ $cfg.VariablesHashMaxSize }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    underscores_in_headers          {{ if $cfg.EnableUnderscoresInHeaders }}on{{ else }}off{{ end }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    ignore_invalid_headers          {{ if $cfg.IgnoreInvalidHeaders }}on{{ else }}off{{ end }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    limit_req_status                {{ $cfg.LimitReqStatusCode }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    limit_conn_status               {{ $cfg.LimitConnStatusCode }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ buildOpentracing $cfg $servers }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    include /etc/nginx/mime.types;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    default_type {{ $cfg.DefaultType }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.EnableBrotli }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    brotli on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    brotli_comp_level {{ $cfg.BrotliLevel }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    brotli_min_length {{ $cfg.BrotliMinLength }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    brotli_types {{ $cfg.BrotliTypes }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.UseGzip }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_comp_level {{ $cfg.GzipLevel }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_http_version 1.1;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_min_length {{ $cfg.GzipMinLength}};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_types {{ $cfg.GzipTypes }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_proxied any;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    gzip_vary on;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # Custom headers for response
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ range $k, $v := $addHeaders }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    more_set_headers {{ printf &#34;%s: %s&#34; $k $v | quote }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    server_tokens {{ if $cfg.ShowServerTokens }}on{{ else }}off{{ end }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if not $cfg.ShowServerTokens }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    more_clear_headers Server;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # disable warnings
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    uninitialized_variable_warn off;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # Additional available variables:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # $namespace
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # $ingress_name
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # $service_name
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # $service_port
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    log_format upstreaminfo {{ if $cfg.LogFormatEscapeJSON }}escape=json {{ end }}&#39;</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.LogFormatUpstream <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#4e9a06">&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* map urls that should not appear in access.log */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{/* http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log */}}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    map $request_uri $loggable {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ range $reqUri := $cfg.SkipAccessLogURLs }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ $reqUri }} 0;{{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        default 1;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if or $cfg.DisableAccessLog $cfg.DisableHTTPAccessLog }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    access_log off;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.EnableSyslog }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    access_log syslog:server={{ $cfg.SyslogHost }}:{{ $cfg.SyslogPort }} upstreaminfo if=$loggable;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    access_log {{ or $cfg.HttpAccessLogPath $cfg.AccessLogPath }} upstreaminfo {{ $cfg.AccessLogParams }} if=$loggable;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if $cfg.EnableSyslog }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    error_log syslog:server={{ $cfg.SyslogHost }}:{{ $cfg.SyslogPort }} {{ $cfg.ErrorLogLevel }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    error_log  {{ $cfg.ErrorLogPath }} {{ $cfg.ErrorLogLevel }};
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ buildResolvers $cfg.Resolver $cfg.DisableIpv6DNS }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # See https://www.nginx.com/blog/websocket-nginx
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    map $http_upgrade $connection_upgrade {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        default          upgrade;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ if (gt $cfg.UpstreamKeepaliveConnections 0) }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        # See http://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        &#39;&#39;               &#39;&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ else }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        &#39;&#39;               close;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # Reverse proxies can detect if a client provides a X-Request-ID header, and pass it on to the backend server.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # If no such header is provided, it can provide a random value.
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    map $http_x_request_id $req_id {
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        default   $http_x_request_id;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ if $cfg.GenerateRequestID }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        &#34;&#34;        $request_id;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">        {{ end }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    }
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    {{ if and $cfg.UseForwardedHeaders $cfg.ComputeFullForwardedFor }}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">    # We can&#39;</span>t use <span style="color:#000">$proxy_add_x_forwarded_for</span> because the realip module
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># replaces the remote_addr too soon</span>
</span></span><span style="display:flex;"><span>    map <span style="color:#000">$http_x_forwarded_for</span> <span style="color:#000">$full_x_forwarded_for</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.UseProxyProtocol <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        default          <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_x_forwarded_for</span><span style="color:#4e9a06">, </span><span style="color:#000">$proxy_protocol_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;&#39;</span>               <span style="color:#4e9a06">&#34;</span><span style="color:#000">$proxy_protocol_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        default          <span style="color:#4e9a06">&#34;</span><span style="color:#000">$http_x_forwarded_for</span><span style="color:#4e9a06">, </span><span style="color:#000">$realip_remote_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#4e9a06">&#39;&#39;</span>               <span style="color:#4e9a06">&#34;</span><span style="color:#000">$realip_remote_addr</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Create a variable that contains the literal $ character.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This works because the geo module will not resolve variables.</span>
</span></span><span style="display:flex;"><span>    geo <span style="color:#000">$literal_dollar</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        default <span style="color:#4e9a06">&#34;</span>$<span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server_name_in_redirect off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    port_in_redirect        off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ssl_protocols <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLProtocols <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ssl_early_data <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.SSLEarlyData <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># turn on session caching to drastically improve performance</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.SSLSessionCache <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    ssl_session_cache shared:SSL:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLSessionCacheSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    ssl_session_timeout <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLSessionTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># allow configuring ssl session tickets</span>
</span></span><span style="display:flex;"><span>    ssl_session_tickets <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.SSLSessionTickets <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.SSLSessionTicketKey <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    ssl_session_ticket_key /etc/nginx/tickets.key<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># slightly reduce the time-to-first-byte</span>
</span></span><span style="display:flex;"><span>    ssl_buffer_size <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLBufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.SSLCiphers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># allow configuring custom ssl ciphers</span>
</span></span><span style="display:flex;"><span>    ssl_ciphers <span style="color:#4e9a06">&#39;{{ $cfg.SSLCiphers }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    ssl_prefer_server_ciphers on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.SSLDHParam<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># allow custom DH file http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_dhparam</span>
</span></span><span style="display:flex;"><span>    ssl_dhparam <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLDHParam <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ssl_ecdh_curve <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.SSLECDHCurve <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># PEM sha: {{ $cfg.DefaultSSLCertificate.PemSHA }}</span>
</span></span><span style="display:flex;"><span>    ssl_certificate     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.DefaultSSLCertificate.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    ssl_certificate_key <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.DefaultSSLCertificate.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.CustomHTTPErrors<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    proxy_intercept_errors on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$errCode</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.CustomHTTPErrors <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    error_page <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">=</span> @custom_upstream-default-backend_<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    proxy_ssl_session_reuse on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.AllowBackendServerHeader <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    proxy_pass_header Server<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$header</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.HideHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>proxy_hide_header <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$header</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.HTTPSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.HTTPSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    upstream upstream_balancer <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">### Attention!!!</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># We no longer create &#34;upstream&#34; section for every backend.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Backends are handled dynamically using Lua. If you would like to debug</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># and see what backends ingress-nginx has in its memory you can</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># install our kubectl plugin https://kubernetes.github.io/ingress-nginx/kubectl-plugin.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Once you have the plugin you can use &#34;kubectl ingress-nginx backends&#34; command to</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># inspect current backends.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">#</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">###</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        server 0.0.0.1<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># placeholder</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        balancer_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          balancer.balance<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>gt <span style="color:#000">$cfg</span>.UpstreamKeepaliveConnections 0<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        keepalive <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.UpstreamKeepaliveConnections <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        keepalive_time <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.UpstreamKeepaliveTime <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        keepalive_timeout  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.UpstreamKeepaliveTimeout <span style="color:#ce5c00;font-weight:bold">}}</span>s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        keepalive_requests <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.UpstreamKeepaliveRequests <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$rl</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>filterRateLimits <span style="color:#000">$servers</span> <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Ratelimit {{ $rl.Name }}</span>
</span></span><span style="display:flex;"><span>    geo <span style="color:#000">$remote_addr</span> <span style="color:#000">$whitelist_</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$rl</span>.ID <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        default 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$ip</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$rl</span>.Whitelist <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ip</span> <span style="color:#ce5c00;font-weight:bold">}}</span> 1<span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Ratelimit {{ $rl.Name }}</span>
</span></span><span style="display:flex;"><span>    map <span style="color:#000">$whitelist_</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$rl</span>.ID <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#000">$limit_</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$rl</span>.ID <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.LimitConnZoneVariable <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span>/* build all the required rate limit zones. Each annotation requires a dedicated zone */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span>/* 1MB -&gt; <span style="color:#0000cf;font-weight:bold">16</span> thousand 64-byte states or about <span style="color:#0000cf;font-weight:bold">8</span> thousand 128-byte states */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$zone</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>buildRateLimitZones <span style="color:#000">$servers</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$zone</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Cache for internal auth checks</span>
</span></span><span style="display:flex;"><span>    proxy_cache_path /tmp/nginx/nginx-cache-auth <span style="color:#000">levels</span><span style="color:#ce5c00;font-weight:bold">=</span>1:2 <span style="color:#000">keys_zone</span><span style="color:#ce5c00;font-weight:bold">=</span>auth_cache:10m <span style="color:#000">max_size</span><span style="color:#ce5c00;font-weight:bold">=</span>128m <span style="color:#000">inactive</span><span style="color:#ce5c00;font-weight:bold">=</span>30m <span style="color:#000">use_temp_path</span><span style="color:#ce5c00;font-weight:bold">=</span>off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Global filters</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$ip</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.BlockCIDRs <span style="color:#ce5c00;font-weight:bold">}}</span>deny <span style="color:#ce5c00;font-weight:bold">{{</span> trimSpace <span style="color:#000">$ip</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockUserAgents<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    map <span style="color:#000">$http_user_agent</span> <span style="color:#000">$block_ua</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        default 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$ua</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.BlockUserAgents <span style="color:#ce5c00;font-weight:bold">}}{{</span> trimSpace <span style="color:#000">$ua</span> <span style="color:#ce5c00;font-weight:bold">}}</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockReferers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    map <span style="color:#000">$http_referer</span> <span style="color:#000">$block_ref</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        default 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$ref</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.BlockReferers <span style="color:#ce5c00;font-weight:bold">}}{{</span> trimSpace <span style="color:#000">$ref</span> <span style="color:#ce5c00;font-weight:bold">}}</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span>/* Build server redirects <span style="color:#ce5c00;font-weight:bold">(</span>from/to www<span style="color:#ce5c00;font-weight:bold">)</span> */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$redirect</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .RedirectServers <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $redirect.From }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        server_name <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$redirect</span>.From <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildHTTPListener  <span style="color:#000">$all</span> <span style="color:#000">$redirect</span>.From <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildHTTPSListener <span style="color:#000">$all</span> <span style="color:#000">$redirect</span>.From <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssl_certificate_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            certificate.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockUserAgents<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$block_ua</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>           <span style="color:#204a87;font-weight:bold">return</span> 403<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockReferers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$block_ref</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>           <span style="color:#204a87;font-weight:bold">return</span> 403<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        set_by_lua_block <span style="color:#000">$redirect_to</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">local</span> <span style="color:#000">request_uri</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.var.request_uri
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> string.sub<span style="color:#ce5c00;font-weight:bold">(</span>request_uri, -1<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;/&#34;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">request_uri</span> <span style="color:#ce5c00;font-weight:bold">=</span> string.sub<span style="color:#ce5c00;font-weight:bold">(</span>request_uri, 1, -2<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.UseForwardedHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">local</span> redirectScheme
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> not ngx.var.http_x_forwarded_proto <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">redirectScheme</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.var.scheme
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">redirectScheme</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.var.http_x_forwarded_proto
</span></span><span style="display:flex;"><span>            end
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">local</span> <span style="color:#000">redirectScheme</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.var.scheme
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> ne <span style="color:#000">$all</span>.ListenPorts.HTTPS <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$redirect_port</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;:%v&#34;</span> <span style="color:#000">$all</span>.ListenPorts.HTTPS<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> string.format<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%s://%s%s%s&#34;</span>, redirectScheme, <span style="color:#4e9a06">&#34;{{ </span><span style="color:#000">$redirect</span><span style="color:#4e9a06">.To }}&#34;</span>, <span style="color:#4e9a06">&#34;{{ </span><span style="color:#000">$redirect_port</span><span style="color:#4e9a06"> }}&#34;</span>, request_uri<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> string.format<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%s://%s%s&#34;</span>, redirectScheme, <span style="color:#4e9a06">&#34;{{ </span><span style="color:#000">$redirect</span><span style="color:#4e9a06">.To }}&#34;</span>, request_uri<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.Cfg.HTTPRedirectCode <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#000">$redirect_to</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $redirect.From }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$server</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$servers</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$location</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$server</span>.Locations <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$applyGlobalAuth</span> :<span style="color:#ce5c00;font-weight:bold">=</span> shouldApplyGlobalAuth <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg.GlobalExternalAuth.URL <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$applyAuthUpstream</span> :<span style="color:#ce5c00;font-weight:bold">=</span> shouldApplyAuthUpstream <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyAuthUpstream</span> <span style="color:#204a87">true</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyGlobalAuth</span> <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start auth upstream {{ $server.Hostname }}{{ $location.Path }}</span>
</span></span><span style="display:flex;"><span>    upstream <span style="color:#ce5c00;font-weight:bold">{{</span> buildAuthUpstreamName <span style="color:#000">$location</span> <span style="color:#000">$server</span>.Hostname <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span>- <span style="color:#000">$externalAuth</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$location</span>.ExternalAuth <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        server <span style="color:#ce5c00;font-weight:bold">{{</span> extractHostPort <span style="color:#000">$externalAuth</span>.URL <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keepalive <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.KeepaliveConnections <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        keepalive_requests <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.KeepaliveRequests <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        keepalive_timeout <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.KeepaliveTimeout <span style="color:#ce5c00;font-weight:bold">}}</span>s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end auth upstream {{ $server.Hostname }}{{ $location.Path }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$server</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$servers</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## start server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        server_name <span style="color:#ce5c00;font-weight:bold">{{</span> buildServerName <span style="color:#000">$server</span>.Hostname <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span>range <span style="color:#000">$server</span>.Aliases <span style="color:#ce5c00;font-weight:bold">}}{{</span> . <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockUserAgents<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$block_ua</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>           <span style="color:#204a87;font-weight:bold">return</span> 403<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$cfg</span>.BlockReferers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$block_ref</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>           <span style="color:#204a87;font-weight:bold">return</span> 403<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> template <span style="color:#4e9a06">&#34;SERVER&#34;</span> serverConfig <span style="color:#000">$all</span> <span style="color:#000">$server</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cfg</span>.ServerSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ServerSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> template <span style="color:#4e9a06">&#34;CUSTOM_ERRORS&#34;</span> <span style="color:#ce5c00;font-weight:bold">(</span>buildCustomErrorDeps <span style="color:#4e9a06">&#34;upstream-default-backend&#34;</span> <span style="color:#000">$cfg</span>.CustomHTTPErrors <span style="color:#000">$all</span>.EnableMetrics <span style="color:#000">$cfg</span>.EnableModsecurity<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic">## end server {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># backend for when default-backend-service is not configured or it does not have endpoints</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        listen <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.ListenPorts.Default <span style="color:#ce5c00;font-weight:bold">}}</span> default_server <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.ReusePort <span style="color:#ce5c00;font-weight:bold">}}</span>reuseport<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#000">backlog</span><span style="color:#ce5c00;font-weight:bold">={{</span> <span style="color:#000">$all</span>.BacklogSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$IsIPV6Enabled</span> <span style="color:#ce5c00;font-weight:bold">}}</span>listen <span style="color:#ce5c00;font-weight:bold">[</span>::<span style="color:#ce5c00;font-weight:bold">]</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.ListenPorts.Default <span style="color:#ce5c00;font-weight:bold">}}</span> default_server <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.ReusePort <span style="color:#ce5c00;font-weight:bold">}}</span>reuseport<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#000">backlog</span><span style="color:#ce5c00;font-weight:bold">={{</span> <span style="color:#000">$all</span>.BacklogSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#4e9a06">&#34;internal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">return</span> 404<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># default server, used for NGINX healthcheck and access to nginx stats</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        listen 127.0.0.1:<span style="color:#ce5c00;font-weight:bold">{{</span> .StatusPort <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#4e9a06">&#34;internal&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        keepalive_timeout 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        gzip off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.EnableOpentracing <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        opentracing off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$healthzURI</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> 200<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location /is-dynamic-lb-initialized <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            content_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87">local</span> <span style="color:#000">configuration</span> <span style="color:#ce5c00;font-weight:bold">=</span> require<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;configuration&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87">local</span> <span style="color:#000">backend_data</span> <span style="color:#ce5c00;font-weight:bold">=</span> configuration.get_backends_data<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> not backend_data <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>                    ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>ngx.HTTP_INTERNAL_SERVER_ERROR<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>                end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                ngx.say<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;OK&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>ngx.HTTP_OK<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> .StatusPath <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            stub_status on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location /configuration <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            client_max_body_size                    <span style="color:#ce5c00;font-weight:bold">{{</span> luaConfigurationRequestBodySize <span style="color:#000">$cfg</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            client_body_buffer_size                 <span style="color:#ce5c00;font-weight:bold">{{</span> luaConfigurationRequestBodySize <span style="color:#000">$cfg</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_buffering                         off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            content_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              configuration.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location / <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            content_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>ngx.HTTP_NOT_FOUND<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stream <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    lua_package_path <span style="color:#4e9a06">&#34;/etc/nginx/lua/?.lua;/etc/nginx/lua/vendor/?.lua;;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    lua_shared_dict tcp_udp_configuration_data 5M<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    init_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        collectgarbage<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;collect&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        -- init modules
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">local</span> ok, res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;configuration&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">configuration</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;tcp_udp_configuration&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">tcp_udp_configuration</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>          tcp_udp_configuration.prohibited_localhost_port <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;{{ .StatusPort }}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok, <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> pcall<span style="color:#ce5c00;font-weight:bold">(</span>require, <span style="color:#4e9a06">&#34;tcp_udp_balancer&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> not ok <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>          error<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;require failed: &#34;</span> .. tostring<span style="color:#ce5c00;font-weight:bold">(</span>res<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">tcp_udp_balancer</span> <span style="color:#ce5c00;font-weight:bold">=</span> res
</span></span><span style="display:flex;"><span>        end
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    init_worker_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        tcp_udp_balancer.init_worker<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    lua_add_variable <span style="color:#000">$proxy_upstream_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    log_format log_stream <span style="color:#4e9a06">&#39;{{ $cfg.LogFormatStream }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> or <span style="color:#000">$cfg</span>.DisableAccessLog <span style="color:#000">$cfg</span>.DisableStreamAccessLog <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    access_log <span style="color:#ce5c00;font-weight:bold">{{</span> or <span style="color:#000">$cfg</span>.StreamAccessLogPath <span style="color:#000">$cfg</span>.AccessLogPath <span style="color:#ce5c00;font-weight:bold">}}</span> log_stream <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.AccessLogParams <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    error_log  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ErrorLogPath <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ErrorLogLevel <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.EnableRealIp <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$trusted_ip</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$cfg</span>.ProxyRealIPCIDR <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    set_real_ip_from    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$trusted_ip</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    upstream upstream_balancer <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        server 0.0.0.1:1234<span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic"># placeholder</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        balancer_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          tcp_udp_balancer.balance<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        listen 127.0.0.1:<span style="color:#ce5c00;font-weight:bold">{{</span> .StreamPort <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        content_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          tcp_udp_configuration.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># TCP services</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$tcpServer</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .TCPBackends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        preread_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            ngx.var.proxy_upstream_name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;tcp-{{ </span><span style="color:#000">$tcpServer</span><span style="color:#4e9a06">.Backend.Namespace }}-{{ </span><span style="color:#000">$tcpServer</span><span style="color:#4e9a06">.Backend.Name }}-{{ </span><span style="color:#000">$tcpServer</span><span style="color:#4e9a06">.Backend.Port }}&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$address</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.Cfg.BindAddressIpv4 <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$address</span> <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$tcpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$tcpServer</span>.Backend.ProxyProtocol.Decode <span style="color:#ce5c00;font-weight:bold">}}</span> proxy_protocol<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$tcpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$tcpServer</span>.Backend.ProxyProtocol.Decode <span style="color:#ce5c00;font-weight:bold">}}</span> proxy_protocol<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$IsIPV6Enabled</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$address</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.Cfg.BindAddressIpv6 <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$address</span> <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$tcpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$tcpServer</span>.Backend.ProxyProtocol.Decode <span style="color:#ce5c00;font-weight:bold">}}</span> proxy_protocol<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">[</span>::<span style="color:#ce5c00;font-weight:bold">]</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$tcpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$tcpServer</span>.Backend.ProxyProtocol.Decode <span style="color:#ce5c00;font-weight:bold">}}</span> proxy_protocol<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        proxy_timeout           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstream <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream_timeout <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstreamTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream_tries   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstreamTries <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        proxy_pass              upstream_balancer<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$tcpServer</span>.Backend.ProxyProtocol.Encode <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        proxy_protocol          on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># UDP services</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$udpServer</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .UDPBackends <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    server <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        preread_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            ngx.var.proxy_upstream_name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;udp-{{ </span><span style="color:#000">$udpServer</span><span style="color:#4e9a06">.Backend.Namespace }}-{{ </span><span style="color:#000">$udpServer</span><span style="color:#4e9a06">.Backend.Name }}-{{ </span><span style="color:#000">$udpServer</span><span style="color:#4e9a06">.Backend.Port }}&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$address</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.Cfg.BindAddressIpv4 <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$address</span> <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$udpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}</span> udp<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$udpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}</span> udp<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$IsIPV6Enabled</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$address</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.Cfg.BindAddressIpv6 <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$address</span> <span style="color:#ce5c00;font-weight:bold">}}</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$udpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}</span> udp<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        listen                  <span style="color:#ce5c00;font-weight:bold">[</span>::<span style="color:#ce5c00;font-weight:bold">]</span>:<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$udpServer</span>.Port <span style="color:#ce5c00;font-weight:bold">}}</span> udp<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        proxy_responses         <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamResponses <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_timeout           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstream <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream_timeout <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstreamTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_next_upstream_tries   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cfg</span>.ProxyStreamNextUpstreamTries <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_pass              upstream_balancer<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Stream Snippets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$snippet</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .StreamSnippets <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$snippet</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* definition of templates to avoid repetitions */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> define <span style="color:#4e9a06">&#34;CUSTOM_ERRORS&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$enableMetrics</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .EnableMetrics <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$modsecurityEnabled</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .ModsecurityEnabled <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$upstreamName</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .UpstreamName <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$errCode</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .ErrorCodes <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        location @custom_<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$upstreamName</span> <span style="color:#ce5c00;font-weight:bold">}}</span>_<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            internal<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Ensure that modsecurity will not run on custom error pages or they might be blocked</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$modsecurityEnabled</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            modsecurity off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_intercept_errors off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Code             <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Format           <span style="color:#000">$http_accept</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Original-URI     <span style="color:#000">$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Namespace        <span style="color:#000">$namespace</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Ingress-Name     <span style="color:#000">$ingress_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Service-Name     <span style="color:#000">$service_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Service-Port     <span style="color:#000">$service_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Request-ID       <span style="color:#000">$req_id</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Forwarded-For    <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       Host               <span style="color:#000">$best_http_host</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$upstreamName</span> <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            rewrite                <span style="color:#ce5c00;font-weight:bold">(</span>.*<span style="color:#ce5c00;font-weight:bold">)</span> / break<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_pass            http://upstream_balancer<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            log_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$enableMetrics</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>                monitor.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* CORS support from https://michielkalkman.com/snippets/nginx-cors-open-configuration.html */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> define <span style="color:#4e9a06">&#34;CORS&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$cors</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .CorsConfig <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#8f5902;font-style:italic"># Cors Preflight methods needs additional options and different Return Code</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cors</span>.CorsAllowOrigin <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildCorsOriginRegex <span style="color:#000">$cors</span>.CorsAllowOrigin <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$request_method</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;OPTIONS&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$cors</span> <span style="color:#4e9a06">${</span><span style="color:#000">cors</span><span style="color:#4e9a06">}</span>options<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$cors</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Origin: $http_origin&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cors</span>.CorsAllowCredentials <span style="color:#ce5c00;font-weight:bold">}}</span> more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Credentials: {{ $cors.CorsAllowCredentials }}&#39;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Methods: {{ $cors.CorsAllowMethods }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Headers: {{ $cors.CorsAllowHeaders }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cors</span>.CorsExposeHeaders<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span> more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Expose-Headers: {{ $cors.CorsExposeHeaders }}&#39;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Max-Age: {{ $cors.CorsMaxAge }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$cors</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;trueoptions&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Origin: $http_origin&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$cors</span>.CorsAllowCredentials <span style="color:#ce5c00;font-weight:bold">}}</span> more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Credentials: {{ $cors.CorsAllowCredentials }}&#39;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Methods: {{ $cors.CorsAllowMethods }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Allow-Headers: {{ $cors.CorsAllowHeaders }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$cors</span>.CorsExposeHeaders<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span> more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Expose-Headers: {{ $cors.CorsExposeHeaders }}&#39;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Access-Control-Max-Age: {{ $cors.CorsMaxAge }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Content-Type: text/plain charset=UTF-8&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        more_set_headers <span style="color:#4e9a06">&#39;Content-Length: 0&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> 204<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span>/* definition of server-template to avoid repetitions with server-alias */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> define <span style="color:#4e9a06">&#34;SERVER&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .First <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span> :<span style="color:#ce5c00;font-weight:bold">=</span> .Second <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildHTTPListener  <span style="color:#000">$all</span> <span style="color:#000">$server</span>.Hostname <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildHTTPSListener <span style="color:#000">$all</span> <span style="color:#000">$server</span>.Hostname <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#4e9a06">&#34;-&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span> empty <span style="color:#000">$server</span>.CertificateAuth.MatchCN <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$server</span>.CertificateAuth.MatchCN<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span> <span style="color:#000">$ssl_client_s_dn</span> !~ <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.MatchCN <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">403</span> <span style="color:#4e9a06">&#34;client certificate unauthorized&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> eq <span style="color:#000">$server</span>.Hostname <span style="color:#4e9a06">&#34;_&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        ssl_reject_handshake <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.SSLRejectHandshake <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ssl_certificate_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            certificate.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.AuthTLSError<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># {{ $server.AuthTLSError }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> 403<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.CertificateAuth.CAFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># PEM sha: {{ $server.CertificateAuth.CASHA }}</span>
</span></span><span style="display:flex;"><span>        ssl_client_certificate                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.CAFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        ssl_verify_client                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.VerifyClient <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        ssl_verify_depth                        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.ValidationDepth <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.CertificateAuth.CRLFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># PEM sha: {{ $server.CertificateAuth.CRLSHA }}</span>
</span></span><span style="display:flex;"><span>        ssl_crl                                 <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.CRLFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.CertificateAuth.ErrorPage<span style="color:#ce5c00;font-weight:bold">)}}</span>
</span></span><span style="display:flex;"><span>        error_page <span style="color:#0000cf;font-weight:bold">495</span> <span style="color:#000">496</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.CertificateAuth.ErrorPage <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.ProxySSL.CAFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># PEM sha: {{ $server.ProxySSL.CASHA }}</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_trusted_certificate           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.CAFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_ciphers                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.Ciphers <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_protocols                     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.Protocols <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_verify                        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.Verify <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_verify_depth                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.VerifyDepth <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.ProxySSL.ProxySSLName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_name                          <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.ProxySSLName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_server_name                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.ProxySSLServerName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.ProxySSL.PemFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_certificate                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        proxy_ssl_certificate_key               <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ProxySSL.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.SSLCiphers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        ssl_ciphers                             <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.SSLCiphers <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.SSLPreferServerCiphers<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        ssl_prefer_server_ciphers               <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.SSLPreferServerCiphers <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.ServerSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># Custom code snippet configured for host {{ $server.Hostname }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$server</span>.ServerSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$errorLocation</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>buildCustomErrorLocationsPerServer <span style="color:#000">$server</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> template <span style="color:#4e9a06">&#34;CUSTOM_ERRORS&#34;</span> <span style="color:#ce5c00;font-weight:bold">(</span>buildCustomErrorDeps <span style="color:#000">$errorLocation</span>.UpstreamName <span style="color:#000">$errorLocation</span>.Codes <span style="color:#000">$all</span>.EnableMetrics <span style="color:#000">$all</span>.Cfg.EnableModsecurity<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> buildMirrorLocations <span style="color:#000">$server</span>.Locations <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$enforceRegex</span> :<span style="color:#ce5c00;font-weight:bold">=</span> enforceRegexModifier <span style="color:#000">$server</span>.Locations <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$location</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$server</span>.Locations <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildLocation <span style="color:#000">$location</span> <span style="color:#000">$enforceRegex</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> :<span style="color:#ce5c00;font-weight:bold">=</span> proxySetHeader <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authPath</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthLocation <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg.GlobalExternalAuth.URL <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$applyGlobalAuth</span> :<span style="color:#ce5c00;font-weight:bold">=</span> shouldApplyGlobalAuth <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg.GlobalExternalAuth.URL <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$applyAuthUpstream</span> :<span style="color:#ce5c00;font-weight:bold">=</span> shouldApplyAuthUpstream <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$location</span>.ExternalAuth <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> eq <span style="color:#000">$applyGlobalAuth</span> <span style="color:#204a87">true</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.Cfg.GlobalExternalAuth <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.Rewrite.AppRoot<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">$uri</span> <span style="color:#ce5c00;font-weight:bold">=</span> /<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">302</span> <span style="color:#000">$scheme</span>://<span style="color:#000">$http_host</span><span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Rewrite.AppRoot <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">location</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            internal<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>or <span style="color:#000">$all</span>.Cfg.EnableOpentracing <span style="color:#000">$location</span>.Opentracing.Enabled<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            opentracing on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            opentracing_propagate_context<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Ensure that modsecurity will not run on an internal location as this is not accessible from outside</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.EnableModsecurity <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            modsecurity off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.AuthCacheKey <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$tmp_cache_key</span> <span style="color:#4e9a06">&#39;{{ $server.Hostname }}{{ $authPath }}{{ $externalAuth.AuthCacheKey }}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$cache_key</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            rewrite_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                ngx.var.cache_key <span style="color:#ce5c00;font-weight:bold">=</span> ngx.encode_base64<span style="color:#ce5c00;font-weight:bold">(</span>ngx.sha1_bin<span style="color:#ce5c00;font-weight:bold">(</span>ngx.var.tmp_cache_key<span style="color:#ce5c00;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_cache auth_cache<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- range <span style="color:#000">$dur</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$externalAuth</span>.AuthCacheDuration <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_cache_valid <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$dur</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_cache_key <span style="color:#4e9a06">&#34;</span><span style="color:#000">$cache_key</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># ngx_auth_request module overrides variables in the parent request,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># therefore we have to explicitly set this variable again so that when the parent request</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># resumes it has the correct value set for this variable so that Lua can pick backend correctly</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#ce5c00;font-weight:bold">{{</span> buildUpstreamName <span style="color:#000">$location</span> <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_pass_request_body     off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            Content-Length          <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Forwarded-Proto       <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Request-ID            <span style="color:#000">$req_id</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.Method <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_method                <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.Method <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Original-URI          <span style="color:#000">$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Scheme                <span style="color:#000">$pass_access_scheme</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_set_header            Host                    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.Host <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Original-URL          <span style="color:#000">$scheme</span>://<span style="color:#000">$http_host$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Original-Method       <span style="color:#000">$request_method</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Sent-From             <span style="color:#4e9a06">&#34;nginx-ingress-controller&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Real-IP               <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#000">$all</span>.Cfg.UseForwardedHeaders <span style="color:#000">$all</span>.Cfg.ComputeFullForwardedFor <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Forwarded-For        <span style="color:#000">$full_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Forwarded-For        <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.RequestRedirect <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Auth-Request-Redirect <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.RequestRedirect <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header            X-Auth-Request-Redirect <span style="color:#000">$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.AuthCacheKey <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_buffering                         <span style="color:#4e9a06">&#34;on&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_buffering                         <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyBuffering <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_buffer_size                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_buffers                           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BuffersNumber <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_request_buffering                 <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.RequestBuffering <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_ssl_server_name       on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_pass_request_headers  on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isValidByteSize <span style="color:#000">$location</span>.Proxy.BodySize <span style="color:#204a87">true</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            client_max_body_size        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BodySize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isValidByteSize <span style="color:#000">$location</span>.ClientBodyBufferSize <span style="color:#204a87">false</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            client_body_buffer_size     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ClientBodyBufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Pass the extracted client certificate to the auth provider</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.CertificateAuth.CAFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$server</span>.CertificateAuth.PassCertToUpstream <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header ssl-client-cert        <span style="color:#000">$ssl_client_escaped_cert</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header ssl-client-verify      <span style="color:#000">$ssl_client_verify</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header ssl-client-subject-dn  <span style="color:#000">$ssl_client_s_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header ssl-client-issuer-dn   <span style="color:#000">$ssl_client_i_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- range <span style="color:#000">$line</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthProxySetHeaders <span style="color:#000">$externalAuth</span>.ProxySetHeaders<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$line</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$externalAuth</span>.AuthSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.AuthSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyAuthUpstream</span> <span style="color:#204a87">true</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyGlobalAuth</span> <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authUpstreamName</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthUpstreamName <span style="color:#000">$location</span> <span style="color:#000">$server</span>.Hostname <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># The target is an upstream with HTTP keepalive, that is why the</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Connection header is cleared and the HTTP version is set to 1.1 as</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># the Nginx documentation suggests:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># http://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive</span>
</span></span><span style="display:flex;"><span>            proxy_http_version 1.1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header Connection <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$target</span> <span style="color:#ce5c00;font-weight:bold">{{</span> changeHostPort <span style="color:#000">$externalAuth</span>.URL <span style="color:#000">$authUpstreamName</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_http_version <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyHTTPVersion <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$target</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$externalAuth</span>.URL <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_pass <span style="color:#000">$target</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isLocationAllowed <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.SigninURL <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> buildAuthSignURLLocation <span style="color:#000">$location</span>.Path <span style="color:#000">$externalAuth</span>.SigninURL <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            internal<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            add_header Set-Cookie <span style="color:#000">$auth_cookie</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Ensure that modsecurity will not run on an internal location as this is not accessible from outside</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.EnableModsecurity <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            modsecurity off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#0000cf;font-weight:bold">302</span> <span style="color:#ce5c00;font-weight:bold">{{</span> buildAuthSignURL <span style="color:#000">$externalAuth</span>.SigninURL <span style="color:#000">$externalAuth</span>.SigninURLRedirectParam <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$path</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">(</span>getIngressInformation <span style="color:#000">$location</span>.Ingress <span style="color:#000">$server</span>.Hostname <span style="color:#000">$location</span>.IngressPath<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$namespace</span>      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span>.Namespace <span style="color:#000;font-weight:bold">|</span> quote<span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$ingress_name</span>   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span>.Rule <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$service_name</span>   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span>.Service <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$service_port</span>   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span>.ServicePort <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$location_path</span>  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ing</span>.Path <span style="color:#000;font-weight:bold">|</span> escapeLiteralDollar <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$global_rate_limit_exceeding</span> n<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> buildOpentracingForLocation <span style="color:#000">$all</span>.Cfg.EnableOpentracing <span style="color:#000">$all</span>.Cfg.OpentracingTrustIncomingSpan <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.Mirror.Source <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            mirror <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Mirror.Source <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            mirror_request_body <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Mirror.RequestBody <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            rewrite_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                lua_ingress.rewrite<span style="color:#ce5c00;font-weight:bold">({{</span> locationConfigForLua <span style="color:#000">$location</span> <span style="color:#000">$all</span> <span style="color:#ce5c00;font-weight:bold">}})</span>
</span></span><span style="display:flex;"><span>                balancer.rewrite<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                plugins.run<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># be careful with `access_by_lua_block` and `satisfy any` directives as satisfy any</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># will always succeed when there&#39;s `access_by_lua_block` that does not have any lua code doing `ngx.exit(ngx.DECLINED)`</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># other authentication method such as basic auth or external auth useless - all requests will be allowed.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">#access_by_lua_block {</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic">#}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            header_filter_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                lua_ingress.header<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                plugins.run<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            body_filter_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                plugins.run<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            log_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                balancer.log<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.EnableMetrics <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>                monitor.call<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                plugins.run<span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#000">$location</span>.Logs.Access <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.Logs.Rewrite <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            rewrite_log on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.HTTP2PushPreload <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            http2_push_preload on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            port_in_redirect <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.UsePortInRedirects <span style="color:#ce5c00;font-weight:bold">}}</span>on<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>off<span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$balancer_ewma_score</span> -1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$proxy_upstream_name</span> <span style="color:#ce5c00;font-weight:bold">{{</span> buildUpstreamName <span style="color:#000">$location</span> <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$proxy_host</span>          <span style="color:#000">$proxy_upstream_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$pass_access_scheme</span>  <span style="color:#000">$scheme</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.UseProxyProtocol <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$pass_server_port</span>    <span style="color:#000">$proxy_protocol_server_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$pass_server_port</span>    <span style="color:#000">$server_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$best_http_host</span>      <span style="color:#000">$http_host</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$pass_port</span>           <span style="color:#000">$pass_server_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$proxy_alternative_upstream_name</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> buildModSecurityForLocation <span style="color:#000">$all</span>.Cfg <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isLocationAllowed <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> gt <span style="color:#ce5c00;font-weight:bold">(</span>len <span style="color:#000">$location</span>.Whitelist.CIDR<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$ip</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$location</span>.Whitelist.CIDR <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            allow <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$ip</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            deny all<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>isLocationInLocationList <span style="color:#000">$location</span> <span style="color:#000">$all</span>.Cfg.NoAuthLocations<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># this location requires authentication</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyAuthUpstream</span> <span style="color:#204a87">true</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$applyGlobalAuth</span> <span style="color:#204a87">false</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87">set</span> <span style="color:#000">$auth_cookie</span> <span style="color:#4e9a06">&#39;&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            add_header Set-Cookie <span style="color:#000">$auth_cookie</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- range <span style="color:#000">$line</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthResponseHeaders <span style="color:#000">$proxySetHeader</span> <span style="color:#000">$externalAuth</span>.ResponseHeaders <span style="color:#204a87">true</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$line</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># `auth_request` module does not support HTTP keepalives in upstream block:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># https://trac.nginx.org/nginx/ticket/1579</span>
</span></span><span style="display:flex;"><span>            access_by_lua_block <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87">local</span> <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.location.capture<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;{{ $authPath }}&#39;</span>, <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">method</span> <span style="color:#ce5c00;font-weight:bold">=</span> ngx.HTTP_GET, <span style="color:#000">body</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;&#39;</span> <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> res.status <span style="color:#ce5c00;font-weight:bold">==</span> ngx.HTTP_OK <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>                    ngx.var.auth_cookie <span style="color:#ce5c00;font-weight:bold">=</span> res.header<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#39;Set-Cookie&#39;</span><span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ce5c00;font-weight:bold">{{</span>- range <span style="color:#000">$line</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthUpstreamLuaHeaders <span style="color:#000">$externalAuth</span>.ResponseHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$line</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ce5c00;font-weight:bold">{{</span>- end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#204a87;font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>                end
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">if</span> res.status <span style="color:#ce5c00;font-weight:bold">==</span> ngx.HTTP_FORBIDDEN <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>                    ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>res.status<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                end
</span></span><span style="display:flex;"><span>                ngx.exit<span style="color:#ce5c00;font-weight:bold">(</span>ngx.HTTP_INTERNAL_SERVER_ERROR<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            auth_request        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$authPath</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            auth_request_set    <span style="color:#000">$auth_cookie</span> <span style="color:#000">$upstream_http_set_cookie</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.AlwaysSetCookie <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            add_header          Set-Cookie <span style="color:#000">$auth_cookie</span> always<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            add_header          Set-Cookie <span style="color:#000">$auth_cookie</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- range <span style="color:#000">$line</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildAuthResponseHeaders <span style="color:#000">$proxySetHeader</span> <span style="color:#000">$externalAuth</span>.ResponseHeaders <span style="color:#204a87">false</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$line</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$externalAuth</span>.SigninURL <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            set_escape_uri <span style="color:#000">$escaped_request_uri</span> <span style="color:#000">$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            error_page <span style="color:#000">401</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">{{</span> buildAuthSignURLLocation <span style="color:#000">$location</span>.Path <span style="color:#000">$externalAuth</span>.SigninURL <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.BasicDigestAuth.Secured <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> eq <span style="color:#000">$location</span>.BasicDigestAuth.Type <span style="color:#4e9a06">&#34;basic&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            auth_basic <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.BasicDigestAuth.Realm <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            auth_basic_user_file <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.BasicDigestAuth.File <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            auth_digest <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.BasicDigestAuth.Realm <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            auth_digest_user_file <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.BasicDigestAuth.File <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> Authorization <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* <span style="color:#204a87;font-weight:bold">if</span> the location contains a rate limit annotation, create one */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$limits</span> :<span style="color:#ce5c00;font-weight:bold">=</span> buildRateLimit <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$limit</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$limits</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$limit</span> <span style="color:#ce5c00;font-weight:bold">}}{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.CorsConfig.CorsEnabled <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> template <span style="color:#4e9a06">&#34;CORS&#34;</span> <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> buildInfluxDB <span style="color:#000">$location</span>.InfluxDB <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isValidByteSize <span style="color:#000">$location</span>.Proxy.BodySize <span style="color:#204a87">true</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            client_max_body_size                    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BodySize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isValidByteSize <span style="color:#000">$location</span>.ClientBodyBufferSize <span style="color:#204a87">false</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            client_body_buffer_size                 <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ClientBodyBufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* By default use vhost as Host to upstream, but allow overrides */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$proxySetHeader</span> <span style="color:#4e9a06">&#34;grpc_set_header&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.UpstreamVhost<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> Host                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.UpstreamVhost <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> Host                   <span style="color:#000">$best_http_host</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Pass the extracted client certificate to the backend</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$server</span>.CertificateAuth.CAFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$server</span>.CertificateAuth.PassCertToUpstream <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> ssl-client-cert        <span style="color:#000">$ssl_client_escaped_cert</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> ssl-client-verify      <span style="color:#000">$ssl_client_verify</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> ssl-client-subject-dn  <span style="color:#000">$ssl_client_s_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> ssl-client-issuer-dn   <span style="color:#000">$ssl_client_i_dn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Allow websocket connections</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span>                        Upgrade           <span style="color:#000">$http_upgrade</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.Connection.Enabled<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span>                        Connection        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Connection.Header <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span>                        Connection        <span style="color:#000">$connection_upgrade</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Request-ID           <span style="color:#000">$req_id</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Real-IP              <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> and <span style="color:#000">$all</span>.Cfg.UseForwardedHeaders <span style="color:#000">$all</span>.Cfg.ComputeFullForwardedFor <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-For        <span style="color:#000">$full_x_forwarded_for</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-For        <span style="color:#000">$remote_addr</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-Host       <span style="color:#000">$best_http_host</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-Port       <span style="color:#000">$pass_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-Proto      <span style="color:#000">$pass_access_scheme</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Forwarded-Scheme     <span style="color:#000">$pass_access_scheme</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.ProxyAddOriginalURIHeader <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Original-URI         <span style="color:#000">$request_uri</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Scheme               <span style="color:#000">$pass_access_scheme</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Pass the original X-Forwarded-For</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> X-Original-Forwarded-For <span style="color:#ce5c00;font-weight:bold">{{</span> buildForwardedFor <span style="color:#000">$all</span>.Cfg.ForwardedForHeader <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># mitigate HTTPoxy Vulnerability</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># https://www.nginx.com/blog/mitigating-the-httpoxy-vulnerability-with-nginx/</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> Proxy                  <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Custom headers to proxied server</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$k</span>, <span style="color:#000">$v</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.ProxySetHeaders <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$proxySetHeader</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$k</span> <span style="color:#ce5c00;font-weight:bold">}}</span>                    <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$v</span> <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_connect_timeout                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ConnectTimeout <span style="color:#ce5c00;font-weight:bold">}}</span>s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_send_timeout                      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.SendTimeout <span style="color:#ce5c00;font-weight:bold">}}</span>s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_read_timeout                      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ReadTimeout <span style="color:#ce5c00;font-weight:bold">}}</span>s<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_buffering                         <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyBuffering <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_buffer_size                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_buffers                           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BuffersNumber <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.BufferSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> isValidByteSize <span style="color:#000">$location</span>.Proxy.ProxyMaxTempFileSize <span style="color:#204a87">true</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_max_temp_file_size                <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyMaxTempFileSize <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_request_buffering                 <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.RequestBuffering <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_http_version                      <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyHTTPVersion <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            proxy_cookie_domain                     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.CookieDomain <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_cookie_path                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.CookiePath <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># In case of errors try the next upstream server before returning an error</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream                     <span style="color:#ce5c00;font-weight:bold">{{</span> buildNextUpstream <span style="color:#000">$location</span>.Proxy.NextUpstream <span style="color:#000">$all</span>.Cfg.RetryNonIdempotent <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream_timeout             <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.NextUpstreamTimeout <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_next_upstream_tries               <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.NextUpstreamTries <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* Add any additional configuration defined */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ConfigurationSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$all</span>.Cfg.LocationSnippet<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Custom code snippet configured in the configuration configmap</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.Cfg.LocationSnippet <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* <span style="color:#204a87;font-weight:bold">if</span> we are sending the request to a custom default backend, we add the required headers */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>hasPrefix <span style="color:#000">$location</span>.Backend <span style="color:#4e9a06">&#34;custom-default-backend-&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Code             503<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Format           <span style="color:#000">$http_accept</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Namespace        <span style="color:#000">$namespace</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Ingress-Name     <span style="color:#000">$ingress_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Service-Name     <span style="color:#000">$service_name</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Service-Port     <span style="color:#000">$service_port</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_set_header       X-Request-ID       <span style="color:#000">$req_id</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.Satisfy <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            satisfy <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Satisfy <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>/* <span style="color:#204a87;font-weight:bold">if</span> a location-specific error override is set, add the proxy_intercept here */<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.CustomHTTPErrors <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Custom error pages per ingress</span>
</span></span><span style="display:flex;"><span>            proxy_intercept_errors on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$errCode</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$location</span>.CustomHTTPErrors <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            error_page <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">=</span> @custom_<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.DefaultBackendUpstreamName <span style="color:#ce5c00;font-weight:bold">}}</span>_<span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$errCode</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$location</span>.BackendProtocol <span style="color:#4e9a06">&#34;FCGI&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            include /etc/nginx/fastcgi_params<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$location</span>.FastCGI.Index -<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            fastcgi_index <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.FastCGI.Index <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span>- end -<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$k</span>, <span style="color:#000">$v</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$location</span>.FastCGI.Params <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            fastcgi_param <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$k</span> <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$v</span> <span style="color:#000;font-weight:bold">|</span> quote <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.Redirect.URL<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Redirect.Code <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Redirect.URL <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> buildProxyPass <span style="color:#000">$server</span>.Hostname <span style="color:#000">$all</span>.Backends <span style="color:#000">$location</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>or <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$location</span>.Proxy.ProxyRedirectFrom <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$location</span>.Proxy.ProxyRedirectFrom <span style="color:#4e9a06">&#34;off&#34;</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_redirect                          <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyRedirectFrom <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>eq <span style="color:#000">$location</span>.Proxy.ProxyRedirectTo <span style="color:#4e9a06">&#34;off&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_redirect                          <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyRedirectFrom <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.Proxy.ProxyRedirectTo <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># Location denied. Reason: {{ $location.Denied | quote }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> 503<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.ProxySSL.CAFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8f5902;font-style:italic"># PEM sha: {{ $location.ProxySSL.CASHA }}</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_trusted_certificate           <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.CAFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_ciphers                       <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.Ciphers <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_protocols                     <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.Protocols <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_verify                        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.Verify <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_verify_depth                  <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.VerifyDepth <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.ProxySSL.ProxySSLName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_name                          <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.ProxySSLName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.ProxySSL.ProxySSLServerName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_server_name                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.ProxySSLServerName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> not <span style="color:#ce5c00;font-weight:bold">(</span>empty <span style="color:#000">$location</span>.ProxySSL.PemFileName<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_certificate                   <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            proxy_ssl_certificate_key               <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$location</span>.ProxySSL.PemFileName <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> eq <span style="color:#000">$server</span>.Hostname <span style="color:#4e9a06">&#34;_&#34;</span> <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># health checks in cloud providers require the use of port {{ $all.ListenPorts.HTTP }}</span>
</span></span><span style="display:flex;"><span>        location <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$all</span>.HealthzURI <span style="color:#ce5c00;font-weight:bold">}}</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.EnableOpentracing <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            opentracing off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">return</span> 200<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># this is required to avoid error if nginx is being monitored</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic"># with an external software (like sysdig)</span>
</span></span><span style="display:flex;"><span>        location /nginx_status <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.Cfg.EnableOpentracing <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            opentracing off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$v</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.NginxStatusIpv4Whitelist <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            allow <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$v</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">$all</span>.IsIPV6Enabled -<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> range <span style="color:#000">$v</span> :<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$all</span>.NginxStatusIpv6Whitelist <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            allow <span style="color:#ce5c00;font-weight:bold">{{</span> <span style="color:#000">$v</span> <span style="color:#ce5c00;font-weight:bold">}}</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">{{</span> end -<span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>            deny all<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            access_log off<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            stub_status on<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{{</span> end <span style="color:#ce5c00;font-weight:bold">}}</span>
</span></span></code></pre></div>
	
		<br /><hr />
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>

<div class="d-print-none">
  <h4 class="feedback--title">希望您的反馈</h4>
  <p class="feedback--question">该页面的内容对您有帮助吗?</p>
  <button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">是的</button>
  <button class="btn btn-danger mb-4 feedback--answer feedback--answer-no">没有</button>
  <p class="feedback--response feedback--response-yes">
    感谢您的支持! 如有其他建议，<a href="https://github.com/opsaid/website/issues/new">请告诉我们！</a>
  </p>
  <p class="feedback--response feedback--response-no">
    非常抱歉，您有什么改进建议？<a href="https://github.com/opsaid/website/issues/new">请告诉我们！</a>
  </p>
</div>

<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	<div class="text-muted mt-5 pt-3 border-top">
  最后修改 2023.02.13: <a href="https://github.com/opsaid/website/commit/64e761ec1f0f55ab7dece864cb159eef28746dc0">feat: 可对外发布 ingress-nginx thanos (64e761e)</a>
</div>

</div>


          </main>


        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-0 col-sm-0 text-xs-center order-sm-2">
        
      </div>
      <div class="col-0 col-sm-0 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col- col-sm-12 text-center py-2 order-sm-2">
        <p class="mt-2">
          <small class="text-white">&copy; 2023 The OPSaid Authors. 保留所有权利</small>
          <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank" rel="noopener">隐私政策</a></small>

	
		
	

          <small>|</small>

          
          <small>
            <img style="width:16px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA7SGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMjEgNzkuMTU1NzcyLCAyMDE0LzAxLzEzLTE5OjQ0OjAwICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgICAgICAgICB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxNCAoV2luZG93cyk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMTUtMTEtMTBUMTQ6MDQ6NTArMDg6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE1LTExLTEwVDE0OjA0OjUwKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxNS0xMS0xMFQxNDowNDo1MCswODowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6ODBiY2E5ODUtNGY5Yi02ZTRkLTlmYzktZThmNDkyNjdkZjRlPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD5hZG9iZTpkb2NpZDpwaG90b3Nob3A6ZWRkYWU4MGMtODc3MC0xMWU1LTg0OWEtYmNmZGE2MDI4ZjJlPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6ZDAxN2I5NGUtOTRiZC0yNjQxLThmZjktYmY3YTBhMzY3N2IxPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpIaXN0b3J5PgogICAgICAgICAgICA8cmRmOlNlcT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6aW5zdGFuY2VJRD54bXAuaWlkOmQwMTdiOTRlLTk0YmQtMjY0MS04ZmY5LWJmN2EwYTM2NzdiMTwvc3RFdnQ6aW5zdGFuY2VJRD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxNS0xMS0xMFQxNDowNDo1MCswODowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OnNvZnR3YXJlQWdlbnQ+QWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo4MGJjYTk4NS00ZjliLTZlNGQtOWZjOS1lOGY0OTI2N2RmNGU8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTUtMTEtMTBUMTQ6MDQ6NTArMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE0IChXaW5kb3dzKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8cGhvdG9zaG9wOkRvY3VtZW50QW5jZXN0b3JzPgogICAgICAgICAgICA8cmRmOkJhZz4KICAgICAgICAgICAgICAgPHJkZjpsaT4zQ0I4RkVFOEMyRUJFNkU1QTREQTk3MzI4MzU0MTI0RTwvcmRmOmxpPgogICAgICAgICAgICAgICA8cmRmOmxpPmFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiZGRmY2Y2Zi04NzcwLTExZTUtODQ5YS1iY2ZkYTYwMjhmMmU8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6QmFnPgogICAgICAgICA8L3Bob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHBob3Rvc2hvcDpJQ0NQcm9maWxlPnNSR0IgSUVDNjE5NjYtMi4xPC9waG90b3Nob3A6SUNDUHJvZmlsZT4KICAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9wbmc8L2RjOmZvcm1hdD4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+MjA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+MjA8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu6JurQAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAABRFJREFUeNpE1OtvW/Udx/H3ufj4+Ph2nDh2vLgrTSPaFNqGtd0Gy9LRTVymNoNM6ihCaEwdQ5sYAo0HTOwBYg/Yk0pDiG3qmLSiPtjGJERbdZSQaUArykXt1la9hDRNY6dpYsexj30uPj7ntwcVyT/w0ucrfT5fSQgBdguAEBlZhDhaiVikF2j22lfPjP77+Kc/9ZyO9p37th7s2rLlbegveZ4g6jggS4AMAKkkkhAC366DJJADgaJlgA/unTx+4qmT/7oyKpxJfdYzUDIma7M6TsXoDH+3/8jgnrG/iOC2o8JrIiQJECjpvlt0Q7JoimWEkQHN1Sf+8MbE40+O7226M/rtCYX9+k2e0me55+48XXfn1f1PvvfwiVdfOSLFlKitSbh8hq9+DitZFRlZSaHK1aJ35uV3f3+4zr79/fy42CD9pwtULwdUpwLqu//ID4JzPHPoEQ7+00dc/vM/Eoary3oCPR5dBROeRTxaH7x+9MWpkd3nRsyBPL/InmP6cAN5jUlgtcELkXpMTj19kr3GGfLfuovv7T62Z/GjN67aM2c3XHz/nVUw6jmo7ruJI5eT2idz23lwu0XzbAP5eh3JjBJdCnBP3iSyrhu96VD562nG7m8z8cUm3vwwKCSkVgx5aBWsL1aK4cfvHwilGKg2KWuOxjxEAh+WXKT1Bto2E/lGC42QyrRDX5cHkkStKRPtUQ9sHB5btwLOXHrvh+1yeTiT0KATRRQKZId7aSKw7ukm2Fck8dIQxjNbkHsMctuytOw2CEEhZ0Dp7L1Ls6d+sgIaicxgw/Lp73FB7+bEaQN1V4rqnrUEZQvpfy3sYzfxp5fRnh+m69mtvHWoBsQZ2qzSmlrALU0VV8BwaW5Po6ZyZ9Gi+HWN19+M859XSgztKJA2ktgXaoQLHu65GsnyMudfvsKrh6Lkh0w299WplD38pUvDK6CstkyrIZNavMLe+wM6fgL/6Dzdf/scuS9Cu0chzKlkdxUoTFylcvA8rbbC2GiEZHUSq6GiJuUIgAoQM746Lm+4Nhrk+3jiGxYH+np4vTyIP3uB7uokcjqGc6GGNZCjnCnwdzkGKZMnvrlAJ1nEvEPCyKw5tgKCnBMNwdyUxZ2D0/z2V9t48fkRjlqboeEzalfpMmXeOpakiQFkeO7nOjsGJpmbBFybsGNtXQFVs729k8zjz/uUFi7yy+EoY+NxJo7bXJK38MCmLyjEKnSO9NGuOazZaPDrB65x89Q1bF9Hz2qoprYRuPUcvOYnj1ZP/+6wM9/Gq/hQmmH9Q0NE8zoEVYKqSnPBIb2uC9Z2Q6nC9NuXcZJZEv0JYr0G6YF9O7XM9z+QhBAAdFr/fWzp/IHXAtdJVz6cR40LencOEiw5+HYL2dDRu+JIWoTqqSk6gUp6+3p8l2p6w8gjcTM1Lmn33TrZd2ZwFp2yOx9z9HyYzu8aIKi3CKwGGBqKZqLFoL3cpFWqoa/tRi/m8ZZt3LIlYmuaKKkUsS9rI9pXUfjohdzXkr2RTAGvHhIGKmGg4C5aIELa1TrNyUUkJQKShHujQiQmk/92IasZ1s9Ch9Uta0qKaPeOhyw7/ZpdKrU0ZZlUrkNEstEkH8VbRjgOyY1ZUgMpZK2JmtaQMr3XO+pdv1GN23+kaIus1kb4SBHVblTjTzsX8y859cUHPX9251c29WwKLSmhm3KXGkti3eB6rMe01dzI2aWphXFnpnaib2culBQFEbgA/H8ALiI3EysggNoAAAAASUVORK5CYII="></img>
            <a href="http://www.beian.gov.cn">闽公网安备 35092202000170号</a>
          </small>
          <small>|</small>
          <small>
            <a href="https://beian.miit.gov.cn/#/Integrated/recordQuery" target="_blank" rel="noopener">闽ICP备2022001029号</a>
          </small>
          
        </p>

        
        <p class="mt-2">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            <img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
          </a>
          <small>本作品采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a> 进行许可。</small>
        </p>
        

      </div>
    </div>
  </div>
</footer>



    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>


















<script src="/js/main.min.aa9f4c5dae6a98b2c46277f4c56f1673a2b000d1756ce4ffae93784cab25e6d5.js" integrity="sha256-qp9MXa5qmLLEYnf0xW8Wc6KwANF1bOT/rpN4TKsl5tU=" crossorigin="anonymous"></script>




  </body>
</html>
